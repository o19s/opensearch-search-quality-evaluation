(window["queryInsightsDashboards_bundle_jsonpfunction"]=window["queryInsightsDashboards_bundle_jsonpfunction"]||[]).push([[4],{380:function(module){module.exports=JSON.parse('{"id":"queryInsightsDashboards","version":"2.19.0.0","opensearchDashboardsVersion":"2.19.0","server":true,"ui":true,"requiredPlugins":["navigation"],"optionalPlugins":["dataSource","dataSourceManagement"],"supportedOSDataSourceVersions":">=2.19.0","requiredOSDataSourcePlugins":["query-insights"]}')},501:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"renderApp",(function(){return renderApp}));var external_osdSharedDeps_React_=__webpack_require__(0);var external_osdSharedDeps_React_default=__webpack_require__.n(external_osdSharedDeps_React_);var external_osdSharedDeps_ReactDom_=__webpack_require__(11);var external_osdSharedDeps_ReactDom_default=__webpack_require__.n(external_osdSharedDeps_ReactDom_);var external_osdSharedDeps_ReactRouterDom_=__webpack_require__(23);var defineProperty=__webpack_require__(357);var defineProperty_default=__webpack_require__.n(defineProperty);var external_osdSharedDeps_ElasticEui_=__webpack_require__(2);const TIMESTAMP="Timestamp";const TYPE="Type";const ID="Id";const QUERY_COUNT="Query Count";const LATENCY="Latency";const CPU_TIME="CPU Time";const MEMORY_USAGE="Memory Usage";const INDICES="Indices";const SEARCH_TYPE="Search Type";const NODE_ID="Coordinator Node ID";const TOTAL_SHARDS="Total Shards";const GROUP_BY="Group by";const AVERAGE_LATENCY="Average Latency";const AVERAGE_CPU_TIME="Average CPU Time";const AVERAGE_MEMORY_USAGE="Average Memory Usage";const MetricType={LATENCY:"latency",CPU:"cpu",MEMORY:"memory"};const METRIC_TYPES_TEXT=[{value:MetricType.LATENCY,text:"Latency"},{value:MetricType.CPU,text:"CPU"},{value:MetricType.MEMORY,text:"Memory"}];const TIME_UNITS_TEXT=[{value:"MINUTES",text:"Minute(s)"},{value:"HOURS",text:"Hour(s)"}];const MINUTES_OPTIONS=[{value:"1",text:"1"},{value:"5",text:"5"},{value:"10",text:"10"},{value:"30",text:"30"}];const GROUP_BY_OPTIONS=[{value:"none",text:"None"},{value:"similarity",text:"Similarity"}];const TIME_UNIT={MINUTES:"MINUTES",HOURS:"HOURS"};const TIME_UNIT_ABBREVIATION={MINUTES:"m",HOURS:"h"};const EXPORTER_TYPE={localIndex:"local_index",none:"none"};const EXPORTER_TYPES_LIST=[{value:EXPORTER_TYPE.localIndex,text:"Local Index"},{value:EXPORTER_TYPE.none,text:"None"}];const DEFAULT_METRIC_ENABLED=true;const DEFAULT_TOP_N_SIZE="10";const DEFAULT_WINDOW_SIZE="5";const DEFAULT_TIME_UNIT=TIME_UNIT.MINUTES;const DEFAULT_GROUP_BY="none";const DEFAULT_EXPORTER_TYPE=EXPORTER_TYPE.localIndex;const DEFAULT_DELETE_AFTER_DAYS="7";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){defineProperty_default()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function calculateMetric(value,count){let unit=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";let factor=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;let defaultMsg=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"N/A";if(value!==undefined&&count!==undefined){return`${calculateMetricNumber(value,count,factor).toFixed(2)} ${unit}`}return defaultMsg}function calculateMetricNumber(value,count){let factor=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;if(value!==undefined&&count!==undefined&&count!==0&&factor!==0){return value/count/factor}return 0}function getTimeUnitFromAbbreviation(timeUnit){for(const[key,value]of Object.entries(TIME_UNIT_ABBREVIATION)){if(value===timeUnit){return key}}return DEFAULT_TIME_UNIT}function getTimeAndUnitFromString(time){const defaultWindowSize=[DEFAULT_WINDOW_SIZE,TIME_UNIT_ABBREVIATION.MINUTES];if(!time){return defaultWindowSize}const timeAndUnit=time.match(/\D+|\d+/g);if(!timeAndUnit||timeAndUnit.length!==2){return defaultWindowSize}return[timeAndUnit[0],getTimeUnitFromAbbreviation(timeAndUnit[1])]}function getMergedMetricSettings(persistent,transient){if(transient!==undefined){return transient}return _objectSpread({},persistent)}function getMergedStringSettings(persistent,transient,defaultVal){var _ref;return(_ref=transient!==null&&transient!==void 0?transient:persistent)!==null&&_ref!==void 0?_ref:defaultVal}var target=__webpack_require__(378);var target_default=__webpack_require__.n(target);const parseDateString=dateString=>{const date=target_default.a.parse(dateString);return date?date.toDate().toISOString():(new Date).toISOString()};var semver=__webpack_require__(379);var semver_default=__webpack_require__.n(semver);var opensearch_dashboards=__webpack_require__(380);function getDataSourceEnabledUrl(dataSource){const url=new URL(window.location.href);url.searchParams.set("dataSource",JSON.stringify(dataSource));return url}function getDataSourceFromUrl(){const urlParams=new URLSearchParams(window.location.search);const dataSourceParam=urlParams&&urlParams.get("dataSource")||"{}";try{return JSON.parse(dataSourceParam)}catch(e){return JSON.parse("{}")}}const isDataSourceCompatible=dataSource=>{if("requiredOSDataSourcePlugins"in opensearch_dashboards&&!opensearch_dashboards.requiredOSDataSourcePlugins.every(plugin=>{var _dataSource$attribute;return(_dataSource$attribute=dataSource.attributes.installedPlugins)===null||_dataSource$attribute===void 0?void 0:_dataSource$attribute.includes(plugin)})){return false}if("supportedOSDataSourceVersions"in opensearch_dashboards&&!semver_default.a.satisfies(dataSource.attributes.dataSourceVersion,opensearch_dashboards.supportedOSDataSourceVersions)){return false}return true};const QueryInsightsDataSourceMenu=external_osdSharedDeps_React_default.a.memo(props=>{var _depsStart$dataSource;const{coreStart:coreStart,depsStart:depsStart,dataSourceManagement:dataSourceManagement,params:params,setDataSource:setDataSource,selectedDataSource:selectedDataSource,onManageDataSource:onManageDataSource,onSelectedDataSource:onSelectedDataSource,dataSourcePickerReadOnly:dataSourcePickerReadOnly}=props;const{setHeaderActionMenu:setHeaderActionMenu}=params;const DataSourceMenu=dataSourceManagement===null||dataSourceManagement===void 0?void 0:dataSourceManagement.ui.getDataSourceMenu();const dataSourceEnabled=!!((_depsStart$dataSource=depsStart.dataSource)!==null&&_depsStart$dataSource!==void 0&&_depsStart$dataSource.dataSourceEnabled);const wrapSetDataSourceWithUpdateUrl=dataSources=>{window.history.replaceState({},"",getDataSourceEnabledUrl(dataSources[0]).toString());setDataSource(dataSources[0]);onSelectedDataSource()};return dataSourceEnabled?external_osdSharedDeps_React_default.a.createElement(DataSourceMenu,{onManageDataSource:onManageDataSource,setMenuMountPoint:setHeaderActionMenu,componentType:dataSourcePickerReadOnly?"DataSourceView":"DataSourceSelectable",componentConfig:{onManageDataSource:onManageDataSource,savedObjects:coreStart.savedObjects.client,notifications:coreStart.notifications,activeOption:selectedDataSource.id||selectedDataSource.label?[selectedDataSource]:undefined,onSelectedDataSources:wrapSetDataSourceWithUpdateUrl,fullWidth:true,dataSourceFilter:isDataSourceCompatible}}):null},(prevProps,newProps)=>prevProps.selectedDataSource.id===newProps.selectedDataSource.id&&prevProps.dataSourcePickerReadOnly===newProps.dataSourcePickerReadOnly);const TIMESTAMP_FIELD="timestamp";const MEASUREMENTS_FIELD="measurements";const LATENCY_FIELD="measurements.latency";const CPU_FIELD="measurements.cpu";const MEMORY_FIELD="measurements.memory";const INDICES_FIELD="indices";const SEARCH_TYPE_FIELD="search_type";const NODE_ID_FIELD="node_id";const TOTAL_SHARDS_FIELD="total_shards";const METRIC_DEFAULT_MSG="Not enabled";const GROUP_BY_FIELD="group_by";const QueryInsights=_ref=>{let{queries:queries,loading:loading,onTimeChange:onTimeChange,recentlyUsedRanges:recentlyUsedRanges,currStart:currStart,currEnd:currEnd,core:core,depsStart:depsStart,params:params,retrieveQueries:retrieveQueries,dataSourceManagement:dataSourceManagement}=_ref;const history=Object(external_osdSharedDeps_ReactRouterDom_["useHistory"])();const location=Object(external_osdSharedDeps_ReactRouterDom_["useLocation"])();const[pagination,setPagination]=Object(external_osdSharedDeps_React_["useState"])({pageIndex:0});const from=parseDateString(currStart);const to=parseDateString(currEnd);const{dataSource:dataSource,setDataSource:setDataSource}=Object(external_osdSharedDeps_React_["useContext"])(DataSourceContext);Object(external_osdSharedDeps_React_["useEffect"])(()=>{core.chrome.setBreadcrumbs([{text:"Query insights",href:QUERY_INSIGHTS,onClick:e=>{e.preventDefault();history.push(QUERY_INSIGHTS)}}])},[core.chrome,history,location]);const convertTime=unixTime=>{const date=new Date(unixTime);const loc=date.toDateString().split(" ");return`${loc[1]} ${loc[2]}, ${loc[3]} @ ${date.toLocaleTimeString("en-US")}`};const cols=[{name:ID,render:query=>external_osdSharedDeps_React_default.a.createElement("span",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>{const route=query.group_by==="SIMILARITY"?`/query-group-details?from=${from}&to=${to}&id=${query.id}`:`/query-details?from=${from}&to=${to}&id=${query.id}`;history.push(route)}},query.id||"-"," ")),sortable:query=>query.id||"-",truncateText:true},{name:TYPE,render:query=>external_osdSharedDeps_React_default.a.createElement("span",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>{const route=query.group_by==="SIMILARITY"?`/query-group-details?from=${from}&to=${to}&id=${query.id}`:`/query-details?from=${from}&to=${to}&id=${query.id}`;history.push(route)}},query.group_by==="SIMILARITY"?"group":"query")),sortable:query=>query.group_by||"query",truncateText:true},{field:MEASUREMENTS_FIELD,name:QUERY_COUNT,render:measurements=>{var _measurements$latency,_measurements$cpu,_measurements$memory;return`${(measurements===null||measurements===void 0||(_measurements$latency=measurements.latency)===null||_measurements$latency===void 0?void 0:_measurements$latency.count)||(measurements===null||measurements===void 0||(_measurements$cpu=measurements.cpu)===null||_measurements$cpu===void 0?void 0:_measurements$cpu.count)||(measurements===null||measurements===void 0||(_measurements$memory=measurements.memory)===null||_measurements$memory===void 0?void 0:_measurements$memory.count)||1}`},sortable:measurements=>{var _measurements$latency2,_measurements$cpu2,_measurements$memory2;return Number((measurements===null||measurements===void 0||(_measurements$latency2=measurements.latency)===null||_measurements$latency2===void 0?void 0:_measurements$latency2.count)||(measurements===null||measurements===void 0||(_measurements$cpu2=measurements.cpu)===null||_measurements$cpu2===void 0?void 0:_measurements$cpu2.count)||(measurements===null||measurements===void 0||(_measurements$memory2=measurements.memory)===null||_measurements$memory2===void 0?void 0:_measurements$memory2.count)||1)},truncateText:true},{name:TIMESTAMP,render:query=>{const isQuery=query.group_by==="NONE";const linkContent=isQuery?convertTime(query.timestamp):"-";const onClickHandler=()=>{const route=`/query-details?from=${from}&to=${to}&id=${query.id}`;history.push(route)};return external_osdSharedDeps_React_default.a.createElement("span",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiLink"],{onClick:onClickHandler},linkContent))},sortable:query=>query.timestamp,truncateText:true},{field:LATENCY_FIELD,name:LATENCY,render:latency=>calculateMetric(latency===null||latency===void 0?void 0:latency.number,latency===null||latency===void 0?void 0:latency.count,"ms",1,METRIC_DEFAULT_MSG),sortable:query=>{var _query$measurements,_query$measurements2;return calculateMetricNumber((_query$measurements=query.measurements)===null||_query$measurements===void 0||(_query$measurements=_query$measurements.latency)===null||_query$measurements===void 0?void 0:_query$measurements.number,(_query$measurements2=query.measurements)===null||_query$measurements2===void 0||(_query$measurements2=_query$measurements2.latency)===null||_query$measurements2===void 0?void 0:_query$measurements2.count)},truncateText:true},{field:CPU_FIELD,name:CPU_TIME,render:cpu=>calculateMetric(cpu===null||cpu===void 0?void 0:cpu.number,cpu===null||cpu===void 0?void 0:cpu.count,"ms",1e6,METRIC_DEFAULT_MSG),sortable:query=>{var _query$measurements3,_query$measurements4;return calculateMetricNumber((_query$measurements3=query.measurements)===null||_query$measurements3===void 0||(_query$measurements3=_query$measurements3.cpu)===null||_query$measurements3===void 0?void 0:_query$measurements3.number,(_query$measurements4=query.measurements)===null||_query$measurements4===void 0||(_query$measurements4=_query$measurements4.cpu)===null||_query$measurements4===void 0?void 0:_query$measurements4.count)},truncateText:true},{field:MEMORY_FIELD,name:MEMORY_USAGE,render:memory=>calculateMetric(memory===null||memory===void 0?void 0:memory.number,memory===null||memory===void 0?void 0:memory.count,"B",1,METRIC_DEFAULT_MSG),sortable:query=>{var _query$measurements5,_query$measurements6;return calculateMetricNumber((_query$measurements5=query.measurements)===null||_query$measurements5===void 0||(_query$measurements5=_query$measurements5.memory)===null||_query$measurements5===void 0?void 0:_query$measurements5.number,(_query$measurements6=query.measurements)===null||_query$measurements6===void 0||(_query$measurements6=_query$measurements6.memory)===null||_query$measurements6===void 0?void 0:_query$measurements6.count)},truncateText:true},{field:INDICES_FIELD,name:INDICES,render:(indices,query)=>{const isSimilarity=query.group_by==="SIMILARITY";return isSimilarity?"-":Array.from(new Set(indices.flat())).join(", ")},sortable:true,truncateText:true},{field:SEARCH_TYPE_FIELD,name:SEARCH_TYPE,render:(searchType,query)=>{const isSimilarity=query.group_by==="SIMILARITY";return isSimilarity?"-":searchType.replaceAll("_"," ")},sortable:true,truncateText:true},{field:NODE_ID_FIELD,name:NODE_ID,render:(nodeId,query)=>{const isSimilarity=query.group_by==="SIMILARITY";return isSimilarity?"-":nodeId},sortable:true,truncateText:true},{field:TOTAL_SHARDS_FIELD,name:TOTAL_SHARDS,render:(totalShards,query)=>{const isSimilarity=query.group_by==="SIMILARITY";return isSimilarity?"-":totalShards},sortable:true,truncateText:true}];const onRefresh=async _ref2=>{let{start:start,end:end}=_ref2;onTimeChange({start:start,end:end})};const filterDuplicates=options=>options.filter((value,index,self)=>index===self.findIndex(t=>t.value===value.value));return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(QueryInsightsDataSourceMenu,{coreStart:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement,setDataSource:setDataSource,selectedDataSource:dataSource,onManageDataSource:()=>{},onSelectedDataSource:()=>{retrieveQueries(currStart,currEnd)},dataSourcePickerReadOnly:false}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiInMemoryTable"],{items:queries,columns:cols,sorting:{sort:{field:TIMESTAMP_FIELD,direction:"desc"}},onTableChange:_ref3=>{let{page:{index:index}}=_ref3;return setPagination({pageIndex:index})},pagination:pagination,loading:loading,search:{box:{placeholder:"Search queries",schema:false},filters:[{type:"field_value_selection",field:GROUP_BY_FIELD,name:TYPE,multiSelect:"or",options:[{value:"NONE",name:"query",view:"query"},{value:"SIMILARITY",name:"group",view:"group"}],noOptionsMessage:"No data available for the selected type"},{type:"field_value_selection",field:INDICES_FIELD,name:INDICES,multiSelect:"or",options:filterDuplicates(queries.map(query=>{const values=Array.from(new Set(query[INDICES_FIELD].flat()));return{value:values.join(","),name:values.join(","),view:values.join(", ")}}))},{type:"field_value_selection",field:SEARCH_TYPE_FIELD,name:SEARCH_TYPE,multiSelect:"or",options:filterDuplicates(queries.map(query=>({value:query[SEARCH_TYPE_FIELD],name:query[SEARCH_TYPE_FIELD],view:query[SEARCH_TYPE_FIELD]})))},{type:"field_value_selection",field:NODE_ID_FIELD,name:NODE_ID,multiSelect:"or",options:filterDuplicates(queries.map(query=>({value:query[NODE_ID_FIELD],name:query[NODE_ID_FIELD],view:query[NODE_ID_FIELD].replaceAll("_"," ")})))}],toolsRight:[external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSuperDatePicker"],{start:currStart,end:currEnd,onTimeChange:onTimeChange,recentlyUsedRanges:recentlyUsedRanges,onRefresh:onRefresh,updateButtonProps:{fill:false}})]},executeQueryOptions:{defaultFields:[TIMESTAMP_FIELD,MEASUREMENTS_FIELD,LATENCY_FIELD,CPU_FIELD,MEMORY_FIELD,INDICES_FIELD,SEARCH_TYPE_FIELD,NODE_ID_FIELD,TOTAL_SHARDS_FIELD]},allowNeutralSort:false,itemId:query=>`${query.id}-${query.timestamp}`}))};var QueryInsights_QueryInsights=QueryInsights;const Configuration=_ref=>{let{latencySettings:latencySettings,cpuSettings:cpuSettings,memorySettings:memorySettings,groupBySettings:groupBySettings,dataRetentionSettings:dataRetentionSettings,configInfo:configInfo,core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement}=_ref;const history=Object(external_osdSharedDeps_ReactRouterDom_["useHistory"])();const location=Object(external_osdSharedDeps_ReactRouterDom_["useLocation"])();const[metric,setMetric]=Object(external_osdSharedDeps_React_["useState"])("latency");const[isEnabled,setIsEnabled]=Object(external_osdSharedDeps_React_["useState"])(false);const[topNSize,setTopNSize]=Object(external_osdSharedDeps_React_["useState"])(latencySettings.currTopN);const[windowSize,setWindowSize]=Object(external_osdSharedDeps_React_["useState"])(latencySettings.currWindowSize);const[time,setTime]=Object(external_osdSharedDeps_React_["useState"])(latencySettings.currTimeUnit);const[groupBy,setGroupBy]=Object(external_osdSharedDeps_React_["useState"])(groupBySettings.groupBy);const{dataSource:dataSource,setDataSource:setDataSource}=Object(external_osdSharedDeps_React_["useContext"])(DataSourceContext);const[deleteAfterDays,setDeleteAfterDays]=Object(external_osdSharedDeps_React_["useState"])(dataRetentionSettings.deleteAfterDays);const[exporterType,setExporterTypeType]=Object(external_osdSharedDeps_React_["useState"])(dataRetentionSettings.exporterType);const[metricSettingsMap,setMetricSettingsMap]=Object(external_osdSharedDeps_React_["useState"])({latency:latencySettings,cpu:cpuSettings,memory:memorySettings});const[groupBySettingMap,setGroupBySettingMap]=Object(external_osdSharedDeps_React_["useState"])({groupBy:groupBySettings});const[dataRetentionSettingMap,setDataRetentionSettingMap]=Object(external_osdSharedDeps_React_["useState"])({dataRetention:dataRetentionSettings});Object(external_osdSharedDeps_React_["useEffect"])(()=>{setMetricSettingsMap({latency:latencySettings,cpu:cpuSettings,memory:memorySettings})},[latencySettings,cpuSettings,memorySettings,groupBySettings]);const newOrReset=Object(external_osdSharedDeps_React_["useCallback"])(()=>{const currMetric=metricSettingsMap[metric];setTopNSize(currMetric.currTopN);setWindowSize(currMetric.currWindowSize);setTime(currMetric.currTimeUnit);setIsEnabled(currMetric.isEnabled)},[metric,metricSettingsMap]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{newOrReset()},[newOrReset,metricSettingsMap]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{setGroupBySettingMap({groupBy:groupBySettings});setGroupBy(groupBySettings.groupBy)},[groupBySettings]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{setDataRetentionSettingMap({dataRetention:dataRetentionSettings});setDeleteAfterDays(dataRetentionSettings.deleteAfterDays);setExporterTypeType(dataRetentionSettings.exporterType)},[dataRetentionSettings]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{core.chrome.setBreadcrumbs([{text:"Query insights",href:QUERY_INSIGHTS,onClick:e=>{e.preventDefault();history.push(QUERY_INSIGHTS)}}])},[core.chrome,history,location]);const onMetricChange=e=>{setMetric(e.target.value)};const onEnabledChange=e=>{setIsEnabled(e.target.checked)};const onTopNSizeChange=e=>{setTopNSize(e.target.value)};const onWindowSizeChange=e=>{setWindowSize(e.target.value)};const onTimeChange=e=>{setTime(e.target.value)};const onExporterTypeChange=e=>{setExporterTypeType(e.target.value)};const onGroupByChange=e=>{setGroupBy(e.target.value)};const onDeleteAfterDaysChange=e=>{setDeleteAfterDays(e.target.value)};const MinutesBox=()=>external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSelect"],{id:"minutes",required:true,options:MINUTES_OPTIONS,value:windowSize,onChange:onWindowSizeChange});const HoursBox=()=>external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFieldNumber"],{min:1,max:24,required:true,value:windowSize,onChange:onWindowSizeChange});const WindowChoice=time===TIME_UNITS_TEXT[0].value?MinutesBox:HoursBox;const isChanged=isEnabled!==metricSettingsMap[metric].isEnabled||topNSize!==metricSettingsMap[metric].currTopN||windowSize!==metricSettingsMap[metric].currWindowSize||time!==metricSettingsMap[metric].currTimeUnit||groupBy!==groupBySettingMap.groupBy.groupBy||exporterType!==dataRetentionSettingMap.dataRetention.exporterType||deleteAfterDays!==dataRetentionSettingMap.dataRetention.deleteAfterDays;const isValid=(()=>{const nVal=parseInt(topNSize,10);if(nVal<1||nVal>100)return false;if(time===TIME_UNITS_TEXT[0].value)return true;const windowVal=parseInt(windowSize,10);return windowVal>=1&&windowVal<=24})();const textPadding={lineHeight:"22px",padding:"5px 0px"};const formRowPadding={padding:"0px 0px 20px"};const enabledSymb=external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHealth"],{color:"primary"},"Enabled");const disabledSymb=external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHealth"],{color:"default"},"Disabled");return external_osdSharedDeps_React_default.a.createElement("div",null,external_osdSharedDeps_React_default.a.createElement(QueryInsightsDataSourceMenu,{coreStart:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement,setDataSource:setDataSource,selectedDataSource:dataSource,onManageDataSource:()=>{},onSelectedDataSource:()=>{configInfo(true)},dataSourcePickerReadOnly:false}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:6},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiForm"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Top n queries monitoring configuration settings")))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2,gutterSize:"s",style:{padding:"15px 0px"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Metric Type")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},"Specify the metric type to set settings for.")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{style:formRowPadding},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSelect"],{id:"metricType",required:true,options:METRIC_TYPES_TEXT,value:metric,onChange:onMetricChange}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Enabled")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},`Enable/disable top N query monitoring by ${metric}.`)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{style:formRowPadding},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSwitch"],{label:"",checked:isEnabled,onChange:onEnabledChange,"data-test-subj":"top-n-metric-toggle"})))),isEnabled?external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Value of N (count)")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},"Specify the value of N. N is the number of queries to be collected within the window size.")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{label:`${metric}.top_n_size`,helpText:"Max allowed limit 100.",style:formRowPadding},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFieldNumber"],{min:1,max:100,required:isEnabled,value:topNSize,onChange:onTopNSizeChange}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Window size")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},"The duration during which the Top N queries are collected.")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{label:`${metric}.window_size`,helpText:"Max allowed limit 24 hours.",style:{padding:"15px 0px 5px"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{style:{flexDirection:"row"}},external_osdSharedDeps_React_default.a.createElement(WindowChoice,null)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSelect"],{id:"timeUnit",required:isEnabled,options:TIME_UNITS_TEXT,value:time,onChange:onTimeChange})))))):null))))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m",grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Statuses for configuration metrics")))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"m"},"Latency")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),latencySettings.isEnabled?enabledSymb:disabledSymb)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"m"},"CPU Usage")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),cpuSettings.isEnabled?enabledSymb:disabledSymb)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"m"},"Memory")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),memorySettings.isEnabled?enabledSymb:disabledSymb)))))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:6},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiForm"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Top n queries grouping configuration settings")))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2,gutterSize:"s",style:{padding:"15px 0px"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Group By")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},"Specify the group by type.")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{style:formRowPadding},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSelect"],{id:"groupBy",required:true,options:GROUP_BY_OPTIONS,value:groupBy,onChange:onGroupByChange})))))))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m",grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Statuses for group by")))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"m"},"Group By")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),groupBySettings.groupBy==="similarity"?enabledSymb:disabledSymb)))))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:6},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiForm"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Query Insights export and data retention settings")))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2,gutterSize:"s",style:{padding:"15px 0px"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Exporter")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},"Configure a sink for exporting Query Insights data.")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{style:formRowPadding},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSelect"],{id:"exporterType",required:true,options:EXPORTER_TYPES_LIST,value:exporterType,onChange:onExporterTypeChange}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h3",null,"Delete After (days)")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs",style:textPadding},"Number of days to retain Query Insights data.")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFormRow"],{style:formRowPadding},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFieldNumber"],{disabled:exporterType!==EXPORTER_TYPE.localIndex,min:1,max:180,value:exporterType!==EXPORTER_TYPE.localIndex?"":deleteAfterDays,onChange:onDeleteAfterDaysChange})))))))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m",grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Statuses for data retention")))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"m"},"Exporter")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),exporterType===EXPORTER_TYPE.localIndex?enabledSymb:disabledSymb)))))),isChanged&&isValid?external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiBottomBar"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",justifyContent:"flexEnd"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"ghost",size:"s",iconType:"cross",onClick:newOrReset},"Cancel")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButton"],{"data-test-subj":"save-config-button",color:"primary",fill:true,size:"s",iconType:"check",onClick:()=>{configInfo(false,isEnabled,metric,topNSize,windowSize,time,exporterType,groupBy,deleteAfterDays);return history.push(QUERY_INSIGHTS)}},"Save")))):null)};var Configuration_Configuration=Configuration;var plotly=__webpack_require__(359);var plotly_default=__webpack_require__.n(plotly);const PanelItem=_ref=>{let{label:label,value:value}=_ref;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h4",null,label)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},value))};const QuerySummary=_ref2=>{var _measurements$latency,_measurements$latency2,_measurements$cpu,_measurements$cpu2,_measurements$memory,_measurements$memory2;let{query:query}=_ref2;if(!query){return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"query-details-summary-section"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"No Data Available")))}const convertTime=unixTime=>{const date=new Date(unixTime);const loc=date.toDateString().split(" ");return`${loc[1]} ${loc[2]}, ${loc[3]} @ ${date.toLocaleTimeString("en-US")}`};const{timestamp:timestamp,measurements:measurements,indices:indices,search_type:search_type,node_id:node_id,total_shards:total_shards}=query;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"query-details-summary-section"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Summary")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:4},external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:TIMESTAMP,value:convertTime(timestamp)}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:LATENCY,value:calculateMetric((_measurements$latency=measurements.latency)===null||_measurements$latency===void 0?void 0:_measurements$latency.number,(_measurements$latency2=measurements.latency)===null||_measurements$latency2===void 0?void 0:_measurements$latency2.count,"ms")}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:CPU_TIME,value:calculateMetric((_measurements$cpu=measurements.cpu)===null||_measurements$cpu===void 0?void 0:_measurements$cpu.number,(_measurements$cpu2=measurements.cpu)===null||_measurements$cpu2===void 0?void 0:_measurements$cpu2.count,"ms",1e6)}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:MEMORY_USAGE,value:calculateMetric((_measurements$memory=measurements.memory)===null||_measurements$memory===void 0?void 0:_measurements$memory.number,(_measurements$memory2=measurements.memory)===null||_measurements$memory2===void 0?void 0:_measurements$memory2.count,"B")}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:INDICES,value:indices.toString()}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:SEARCH_TYPE,value:search_type.replaceAll("_"," ")}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:NODE_ID,value:node_id}),external_osdSharedDeps_React_default.a.createElement(PanelItem,{label:TOTAL_SHARDS,value:total_shards})))};var Components_QuerySummary=QuerySummary;const PageHeader=props=>{const useNewUx=props.coreStart.uiSettings.get("home:useNewHomePage");if(useNewUx){return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null)}else{return props.fallBackComponent}};const retrieveQueryById=async(core,dataSourceId,start,end,id)=>{const nullResponse={response:{top_queries:[]}};const params={query:{dataSourceId:dataSourceId,from:start,to:end,id:id}};const fetchMetric=async endpoint=>{try{var _response$response;const response=await core.http.get(endpoint,params);return{response:{top_queries:Array.isArray(response===null||response===void 0||(_response$response=response.response)===null||_response$response===void 0?void 0:_response$response.top_queries)?response.response.top_queries:[]}}}catch(error){console.error("Error occurred while fetching the data:",error);return nullResponse}};try{const topQueriesResponse=await Promise.any([fetchMetric(`/api/top_queries/latency`),fetchMetric(`/api/top_queries/cpu`),fetchMetric(`/api/top_queries/memory`)]);return topQueriesResponse.response.top_queries[0]||null}catch(error){console.error("Error retrieving query details:",error);return null}};const QueryDetails=_ref=>{let{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement}=_ref;const location=Object(external_osdSharedDeps_ReactRouterDom_["useLocation"])();const searchParams=new URLSearchParams(location.search);const id=searchParams.get("id");const from=searchParams.get("from");const to=searchParams.get("to");const[query,setQuery]=Object(external_osdSharedDeps_React_["useState"])(null);const history=Object(external_osdSharedDeps_ReactRouterDom_["useHistory"])();const{dataSource:dataSource,setDataSource:setDataSource}=Object(external_osdSharedDeps_React_["useContext"])(DataSourceContext);const convertTime=Object(external_osdSharedDeps_React_["useCallback"])(unixTime=>{const date=new Date(unixTime);const[_weekDay,month,day,year]=date.toDateString().split(" ");return`${month} ${day}, ${year} @ ${date.toLocaleTimeString("en-US")}`},[]);const fetchQueryDetails=async()=>{const retrievedQuery=await retrieveQueryById(core,getDataSourceFromUrl().id,from,to,id);setQuery(retrievedQuery)};Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(id&&from&&to){fetchQueryDetails()}},[id,from,to]);const initPlotlyChart=Object(external_osdSharedDeps_React_["useCallback"])(()=>{const latencies=Object.values((query===null||query===void 0?void 0:query.phase_latency_map)||[0,0,0]);const data=[{x:latencies.reverse(),y:["Fetch    ","Query    ","Expand    "],type:"bar",orientation:"h",width:.5,marker:{color:["#F990C0","#1BA9F5","#7DE2D1"]},base:[latencies[2]+latencies[1],latencies[2],0],text:latencies.map(value=>`${value}ms`),textposition:"outside",cliponaxis:false}];const layout={autosize:true,margin:{l:80,r:80,t:25,b:15,pad:0},height:120,xaxis:{side:"top",zeroline:false,ticksuffix:"ms",autorangeoptions:{clipmin:0},tickfont:{color:"#535966"},linecolor:"#D4DAE5",gridcolor:"#D4DAE5"},yaxis:{linecolor:"#D4DAE5"}};const config={responsive:true};plotly_default.a.newPlot("latency",data,layout,config)},[query]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(query){core.chrome.setBreadcrumbs([{text:"Query insights",href:QUERY_INSIGHTS,onClick:e=>{e.preventDefault();history.push(QUERY_INSIGHTS)}},{text:`Query details: ${convertTime(query.timestamp)}`}]);initPlotlyChart()}},[query,history,core.chrome,convertTime,initPlotlyChart]);const queryString=query?JSON.stringify(JSON.parse(JSON.stringify(query.source)),null,2):"";const queryDisplay=`{\n  "query": ${queryString?queryString.replace(/\n/g,"\n  "):""}\n}`;return external_osdSharedDeps_React_default.a.createElement("div",null,external_osdSharedDeps_React_default.a.createElement(PageHeader,{coreStart:core,depsStart:depsStart,fallBackComponent:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_osdSharedDeps_React_default.a.createElement("h1",null,"Query details")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}),external_osdSharedDeps_React_default.a.createElement(QueryInsightsDataSourceMenu,{coreStart:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement,setDataSource:setDataSource,selectedDataSource:dataSource,onManageDataSource:()=>{},onSelectedDataSource:fetchQueryDetails,dataSourcePickerReadOnly:true}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(Components_QuerySummary,{query:query}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"query-details-source-section"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",justifyContent:"spaceBetween"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Query"))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButton"],{iconSide:"right",iconType:"popout",target:"_blank",href:"https://playground.opensearch.org/app/searchRelevance#/"},"Open in search comparison"))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"xs"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"jsx",paddingSize:"m",fontSize:"s",overflowHeight:600,isCopyable:true},queryDisplay))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1,style:{alignSelf:"start"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"query-details-latency-chart"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Latency")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),external_osdSharedDeps_React_default.a.createElement("div",{id:"latency"}))))))};var QueryDetails_QueryDetails=QueryDetails;const QueryGroupAggregateSummary_PanelItem=_ref=>{let{label:label,value:value}=_ref;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h4",null,label)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},value))};const QueryGroupAggregateSummary=_ref2=>{var _measurements$latency,_measurements$cpu,_measurements$memory,_measurements$latency2,_measurements$latency3,_measurements$cpu2,_measurements$cpu3,_measurements$memory2,_measurements$memory3;let{query:query}=_ref2;if(!query){return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},"No query data available.")}const{measurements:measurements,id:id,group_by:groupBy}=query;const queryCount=((_measurements$latency=measurements.latency)===null||_measurements$latency===void 0?void 0:_measurements$latency.count)||((_measurements$cpu=measurements.cpu)===null||_measurements$cpu===void 0?void 0:_measurements$cpu.count)||((_measurements$memory=measurements.memory)===null||_measurements$memory===void 0?void 0:_measurements$memory.count)||1;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Aggregate summary for ",queryCount," ",queryCount===1?"query":"queries")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:4},external_osdSharedDeps_React_default.a.createElement(QueryGroupAggregateSummary_PanelItem,{label:ID,value:id}),external_osdSharedDeps_React_default.a.createElement(QueryGroupAggregateSummary_PanelItem,{label:AVERAGE_LATENCY,value:calculateMetric((_measurements$latency2=measurements.latency)===null||_measurements$latency2===void 0?void 0:_measurements$latency2.number,(_measurements$latency3=measurements.latency)===null||_measurements$latency3===void 0?void 0:_measurements$latency3.count,"ms",1)}),external_osdSharedDeps_React_default.a.createElement(QueryGroupAggregateSummary_PanelItem,{label:AVERAGE_CPU_TIME,value:calculateMetric((_measurements$cpu2=measurements.cpu)===null||_measurements$cpu2===void 0?void 0:_measurements$cpu2.number,(_measurements$cpu3=measurements.cpu)===null||_measurements$cpu3===void 0?void 0:_measurements$cpu3.count,"ms",1e6)}),external_osdSharedDeps_React_default.a.createElement(QueryGroupAggregateSummary_PanelItem,{label:AVERAGE_MEMORY_USAGE,value:calculateMetric((_measurements$memory2=measurements.memory)===null||_measurements$memory2===void 0?void 0:_measurements$memory2.number,(_measurements$memory3=measurements.memory)===null||_measurements$memory3===void 0?void 0:_measurements$memory3.count,"B",1)}),external_osdSharedDeps_React_default.a.createElement(QueryGroupAggregateSummary_PanelItem,{label:GROUP_BY,value:groupBy!==undefined?`${groupBy}`:"N/A"})))};const QueryGroupSampleQuerySummary_PanelItem=_ref=>{let{label:label,value:value}=_ref;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h4",null,label)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},value))};const QueryGroupSampleQuerySummary=_ref2=>{let{query:query}=_ref2;if(!query){return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"s"},"No query data available.")}const convertTime=unixTime=>{const date=new Date(unixTime);const loc=date.toDateString().split(" ");return`${loc[1]} ${loc[2]}, ${loc[3]} @ ${date.toLocaleTimeString("en-US")}`};const{timestamp:timestamp,indices:indices,search_type:searchType,node_id:nodeId,total_shards:totalShards}=query;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Sample query summary")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:4},external_osdSharedDeps_React_default.a.createElement(QueryGroupSampleQuerySummary_PanelItem,{label:TIMESTAMP,value:convertTime(timestamp)}),external_osdSharedDeps_React_default.a.createElement(QueryGroupSampleQuerySummary_PanelItem,{label:INDICES,value:indices.toString()}),external_osdSharedDeps_React_default.a.createElement(QueryGroupSampleQuerySummary_PanelItem,{label:SEARCH_TYPE,value:searchType.replace(/_/g," ")}),external_osdSharedDeps_React_default.a.createElement(QueryGroupSampleQuerySummary_PanelItem,{label:NODE_ID,value:nodeId}),external_osdSharedDeps_React_default.a.createElement(QueryGroupSampleQuerySummary_PanelItem,{label:TOTAL_SHARDS,value:totalShards})))};const QueryGroupDetails=_ref=>{let{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement}=_ref;const location=Object(external_osdSharedDeps_ReactRouterDom_["useLocation"])();const searchParams=new URLSearchParams(location.search);const id=searchParams.get("id");const from=searchParams.get("from");const to=searchParams.get("to");const[query,setQuery]=Object(external_osdSharedDeps_React_["useState"])(null);const{dataSource:dataSource,setDataSource:setDataSource}=Object(external_osdSharedDeps_React_["useContext"])(DataSourceContext);const convertTime=unixTime=>{const date=new Date(unixTime);const loc=date.toDateString().split(" ");return loc[1]+" "+loc[2]+", "+loc[3]+" @ "+date.toLocaleTimeString("en-US")};const history=Object(external_osdSharedDeps_ReactRouterDom_["useHistory"])();const fetchQueryDetails=async()=>{const retrievedQuery=await retrieveQueryById(core,getDataSourceFromUrl().id,from,to,id);setQuery(retrievedQuery)};Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(id&&from&&to){fetchQueryDetails()}},[id,from,to]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(query){core.chrome.setBreadcrumbs([{text:"Query insights",href:QUERY_INSIGHTS,onClick:e=>{e.preventDefault();history.push(QUERY_INSIGHTS)}},{text:`Query group details: ${convertTime(query.timestamp)}`}])}},[core.chrome,history,location,query]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{if(query&&query.phase_latency_map){let x=Object.values(query.phase_latency_map);if(x.length<3){x=[0,0,0]}const data=[{x:x.reverse(),y:["Fetch    ","Query    ","Expand    "],type:"bar",orientation:"h",width:.5,marker:{color:["#F990C0","#1BA9F5","#7DE2D1"]},base:[x[2]+x[1],x[2],0],text:x.map(value=>`${value}ms`),textposition:"outside",cliponaxis:false}];const layout={autosize:true,margin:{l:80,r:80,t:25,b:15,pad:0},autorange:true,height:120,xaxis:{side:"top",zeroline:false,ticksuffix:"ms",autorangeoptions:{clipmin:0},tickfont:{color:"#535966"},linecolor:"#D4DAE5",gridcolor:"#D4DAE5"},yaxis:{linecolor:"#D4DAE5"}};const config={responsive:true};plotly_default.a.newPlot("latency",data,layout,config)}},[query]);const queryString=query?JSON.stringify(JSON.parse(JSON.stringify(query.source)),null,2):"";const queryDisplay=`{\n  "query": ${queryString?queryString.replace(/\n/g,"\n  "):""}\n}`;return external_osdSharedDeps_React_default.a.createElement("div",null,external_osdSharedDeps_React_default.a.createElement(PageHeader,{coreStart:core,depsStart:depsStart,fallBackComponent:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_osdSharedDeps_React_default.a.createElement("h1",null,"Query group details")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiIconTip"],{content:"Details for the query group including aggregate statistics and number of queries in the group",position:"right",type:"iInCircle","aria-label":"Details tooltip"})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}),external_osdSharedDeps_React_default.a.createElement(QueryInsightsDataSourceMenu,{coreStart:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement,setDataSource:setDataSource,selectedDataSource:dataSource,onManageDataSource:()=>{},onSelectedDataSource:fetchQueryDetails,dataSourcePickerReadOnly:true}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(QueryGroupAggregateSummary,{query:query})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_osdSharedDeps_React_default.a.createElement("h1",null,"Sample query details")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiIconTip"],{content:"Details for a sample query in the query group. This is the first query encountered in the group.",position:"right",type:"iInCircle","aria-label":"Details tooltip"})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(QueryGroupSampleQuerySummary,{query:query}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",justifyContent:"spaceBetween"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Query"))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiButton"],{iconSide:"right",iconType:"popout",target:"_blank",href:"https://playground.opensearch.org/app/searchRelevance#/"},"Open in search comparision"))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"xs"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"jsx",paddingSize:"m",fontSize:"s",overflowHeight:600,isCopyable:true},queryDisplay))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1,style:{alignSelf:"start"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,"Latency")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),external_osdSharedDeps_React_default.a.createElement("div",{id:"latency"}))))))};function TopNQueries_ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function TopNQueries_objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?TopNQueries_ownKeys(Object(t),!0).forEach((function(r){defineProperty_default()(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):TopNQueries_ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const QUERY_INSIGHTS="/queryInsights";const CONFIGURATION="/configuration";const DataSourceContext=Object(external_osdSharedDeps_React_["createContext"])(null);const TopNQueries=_ref=>{let{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement,initialStart:initialStart="now-1d",initialEnd:initialEnd="now"}=_ref;const history=Object(external_osdSharedDeps_ReactRouterDom_["useHistory"])();const location=Object(external_osdSharedDeps_ReactRouterDom_["useLocation"])();const[loading,setLoading]=Object(external_osdSharedDeps_React_["useState"])(false);const[currStart,setStart]=Object(external_osdSharedDeps_React_["useState"])(initialStart);const[currEnd,setEnd]=Object(external_osdSharedDeps_React_["useState"])(initialEnd);const[recentlyUsedRanges,setRecentlyUsedRanges]=Object(external_osdSharedDeps_React_["useState"])([{start:currStart,end:currEnd}]);const[latencySettings,setLatencySettings]=Object(external_osdSharedDeps_React_["useState"])({isEnabled:DEFAULT_METRIC_ENABLED,currTopN:DEFAULT_TOP_N_SIZE,currWindowSize:DEFAULT_WINDOW_SIZE,currTimeUnit:DEFAULT_TIME_UNIT});const[cpuSettings,setCpuSettings]=Object(external_osdSharedDeps_React_["useState"])({isEnabled:DEFAULT_METRIC_ENABLED,currTopN:DEFAULT_TOP_N_SIZE,currWindowSize:DEFAULT_WINDOW_SIZE,currTimeUnit:DEFAULT_TIME_UNIT});const[memorySettings,setMemorySettings]=Object(external_osdSharedDeps_React_["useState"])({isEnabled:DEFAULT_METRIC_ENABLED,currTopN:DEFAULT_TOP_N_SIZE,currWindowSize:DEFAULT_WINDOW_SIZE,currTimeUnit:DEFAULT_TIME_UNIT});const[groupBySettings,setGroupBySettings]=Object(external_osdSharedDeps_React_["useState"])({groupBy:"none"});const[dataRetentionSettings,setDataRetentionSettings]=Object(external_osdSharedDeps_React_["useState"])({deleteAfterDays:"",exporterType:EXPORTER_TYPE.none});const setMetricSettings=(metricType,updates)=>{switch(metricType){case MetricType.LATENCY:setLatencySettings(prevSettings=>TopNQueries_objectSpread(TopNQueries_objectSpread({},prevSettings),updates));break;case MetricType.CPU:setCpuSettings(prevSettings=>TopNQueries_objectSpread(TopNQueries_objectSpread({},prevSettings),updates));break;case MetricType.MEMORY:setMemorySettings(prevSettings=>TopNQueries_objectSpread(TopNQueries_objectSpread({},prevSettings),updates));break}};const[queries,setQueries]=Object(external_osdSharedDeps_React_["useState"])([]);const tabs=[{id:"topNQueries",name:"Top N queries",route:QUERY_INSIGHTS},{id:"configuration",name:"Configuration",route:CONFIGURATION}];const onSelectedTabChanged=route=>{const{pathname:currPathname}=location;if(!currPathname.includes(route)){history.push(route)}};const renderTab=tab=>external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTab"],{onClick:()=>onSelectedTabChanged(tab.route),isSelected:location.pathname.includes(tab.route),key:tab.id},tab.name);const retrieveQueries=Object(external_osdSharedDeps_React_["useCallback"])(async(start,end)=>{const nullResponse={response:{top_queries:[]}};const apiParams={query:{from:parseDateString(start),to:parseDateString(end),dataSourceId:getDataSourceFromUrl().id}};const fetchMetric=async endpoint=>{try{var _response$response;const response=await core.http.get(endpoint,apiParams);return{response:{top_queries:Array.isArray(response===null||response===void 0||(_response$response=response.response)===null||_response$response===void 0?void 0:_response$response.top_queries)?response.response.top_queries:[]}}}catch{return nullResponse}};try{setLoading(true);const respLatency=latencySettings.isEnabled?await fetchMetric("/api/top_queries/latency"):nullResponse;const respCpu=cpuSettings.isEnabled?await fetchMetric("/api/top_queries/cpu"):nullResponse;const respMemory=memorySettings.isEnabled?await fetchMetric("/api/top_queries/memory"):nullResponse;const newQueries=[...respLatency.response.top_queries,...respCpu.response.top_queries,...respMemory.response.top_queries];const noDuplicates=Array.from(new Set(newQueries.map(item=>JSON.stringify(item)))).map(item=>JSON.parse(item));setQueries(noDuplicates)}catch(error){console.error("Error retrieving queries:",error)}finally{setLoading(false)}},[latencySettings,cpuSettings,memorySettings,core]);const retrieveConfigInfo=Object(external_osdSharedDeps_React_["useCallback"])((async function(get){let enabled=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;let metric=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";let newTopN=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";let newWindowSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";let newTimeUnit=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";let newExporterType=arguments.length>6&&arguments[6]!==undefined?arguments[6]:"";let newGroupBy=arguments.length>7&&arguments[7]!==undefined?arguments[7]:"";let newDeleteAfterDays=arguments.length>8&&arguments[8]!==undefined?arguments[8]:"";if(get){try{var _resp$response,_resp$response2,_persistentSettings$e,_transientSettings$ex,_persistentSettings$e2,_transientSettings$ex2;const resp=await core.http.get("/api/settings",{query:{dataSourceId:getDataSourceFromUrl().id}});const persistentSettings=resp===null||resp===void 0||(_resp$response=resp.response)===null||_resp$response===void 0||(_resp$response=_resp$response.persistent)===null||_resp$response===void 0||(_resp$response=_resp$response.search)===null||_resp$response===void 0||(_resp$response=_resp$response.insights)===null||_resp$response===void 0?void 0:_resp$response.top_queries;const transientSettings=resp===null||resp===void 0||(_resp$response2=resp.response)===null||_resp$response2===void 0||(_resp$response2=_resp$response2.transient)===null||_resp$response2===void 0||(_resp$response2=_resp$response2.search)===null||_resp$response2===void 0||(_resp$response2=_resp$response2.insights)===null||_resp$response2===void 0?void 0:_resp$response2.top_queries;const metrics=[{metricType:MetricType.LATENCY,metricSetting:getMergedMetricSettings(persistentSettings===null||persistentSettings===void 0?void 0:persistentSettings.latency,transientSettings===null||transientSettings===void 0?void 0:transientSettings.latency)},{metricType:MetricType.CPU,metricSetting:getMergedMetricSettings(persistentSettings===null||persistentSettings===void 0?void 0:persistentSettings.cpu,transientSettings===null||transientSettings===void 0?void 0:transientSettings.cpu)},{metricType:MetricType.MEMORY,metricSetting:getMergedMetricSettings(persistentSettings===null||persistentSettings===void 0?void 0:persistentSettings.memory,transientSettings===null||transientSettings===void 0?void 0:transientSettings.memory)}];metrics.forEach(_ref2=>{let{metricType:metricType,metricSetting:metricSetting}=_ref2;if((metricSetting===null||metricSetting===void 0?void 0:metricSetting.enabled)==="false"){setMetricSettings(metricType,{isEnabled:false})}else{var _metricSetting$top_n_;const[time,timeUnits]=getTimeAndUnitFromString(metricSetting.window_size);setMetricSettings(metricType,{isEnabled:true,currTopN:(_metricSetting$top_n_=metricSetting.top_n_size)!==null&&_metricSetting$top_n_!==void 0?_metricSetting$top_n_:DEFAULT_TOP_N_SIZE,currWindowSize:time,currTimeUnit:timeUnits})}});const groupBy=getMergedStringSettings(persistentSettings===null||persistentSettings===void 0?void 0:persistentSettings.group_by,transientSettings===null||transientSettings===void 0?void 0:transientSettings.group_by,DEFAULT_GROUP_BY);setGroupBySettings({groupBy:groupBy});const deleteAfterDays=getMergedStringSettings(persistentSettings===null||persistentSettings===void 0||(_persistentSettings$e=persistentSettings.exporter)===null||_persistentSettings$e===void 0?void 0:_persistentSettings$e.delete_after_days,transientSettings===null||transientSettings===void 0||(_transientSettings$ex=transientSettings.exporter)===null||_transientSettings$ex===void 0?void 0:_transientSettings$ex.delete_after_days,DEFAULT_DELETE_AFTER_DAYS);const exporterType=getMergedStringSettings(persistentSettings===null||persistentSettings===void 0||(_persistentSettings$e2=persistentSettings.exporter)===null||_persistentSettings$e2===void 0?void 0:_persistentSettings$e2.type,transientSettings===null||transientSettings===void 0||(_transientSettings$ex2=transientSettings.exporter)===null||_transientSettings$ex2===void 0?void 0:_transientSettings$ex2.type,DEFAULT_EXPORTER_TYPE);setDataRetentionSettings({deleteAfterDays:deleteAfterDays,exporterType:exporterType})}catch(error){console.error("Failed to retrieve settings:",error)}}else{try{setMetricSettings(metric,{isEnabled:enabled,currTopN:newTopN,currWindowSize:newWindowSize,currTimeUnit:newTimeUnit});setGroupBySettings({groupBy:newGroupBy});setDataRetentionSettings({deleteAfterDays:newDeleteAfterDays,exporterType:newExporterType});await core.http.put("/api/update_settings",{query:{metric:metric,enabled:enabled,top_n_size:newTopN,window_size:`${newWindowSize}${newTimeUnit==="MINUTES"?"m":"h"}`,exporterType:newExporterType,group_by:newGroupBy,delete_after_days:newDeleteAfterDays,dataSourceId:getDataSourceFromUrl().id}})}catch(error){console.error("Failed to set settings:",error)}}}),[core]);const onTimeChange=_ref3=>{let{start:start,end:end}=_ref3;const usedRange=recentlyUsedRanges.filter(range=>!(range.start===start&&range.end===end));usedRange.unshift({start:start,end:end});setStart(start);setEnd(end);setRecentlyUsedRanges(usedRange.length>10?usedRange.slice(0,9):usedRange);retrieveConfigInfo(true);retrieveQueries(start,end)};Object(external_osdSharedDeps_React_["useEffect"])(()=>{onTimeChange({start:currStart,end:currEnd})},[currStart,currEnd]);Object(external_osdSharedDeps_React_["useEffect"])(()=>{retrieveQueries(currStart,currEnd)},[latencySettings,cpuSettings,memorySettings,currStart,currEnd,retrieveQueries]);const dataSourceFromUrl=getDataSourceFromUrl();const[dataSource,setDataSource]=Object(external_osdSharedDeps_React_["useState"])(dataSourceFromUrl);return external_osdSharedDeps_React_default.a.createElement(DataSourceContext.Provider,{value:{dataSource:dataSource,setDataSource:setDataSource}},external_osdSharedDeps_React_default.a.createElement("div",{style:{padding:"35px 35px"}},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Switch"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{exact:true,path:"/query-details"},()=>external_osdSharedDeps_React_default.a.createElement(QueryDetails_QueryDetails,{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{exact:true,path:"/query-group-details"},()=>external_osdSharedDeps_React_default.a.createElement(QueryGroupDetails,{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{exact:true,path:QUERY_INSIGHTS},external_osdSharedDeps_React_default.a.createElement(PageHeader,{coreStart:core,depsStart:depsStart,fallBackComponent:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_osdSharedDeps_React_default.a.createElement("h1",null,"Query insights - Top N queries")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTabs"],null,tabs.map(renderTab)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_osdSharedDeps_React_default.a.createElement(QueryInsights_QueryInsights,{queries:queries,loading:loading,onTimeChange:onTimeChange,recentlyUsedRanges:recentlyUsedRanges,currStart:currStart,currEnd:currEnd,core:core,depsStart:depsStart,params:params,retrieveQueries:retrieveQueries,dataSourceManagement:dataSourceManagement})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{exact:true,path:CONFIGURATION},external_osdSharedDeps_React_default.a.createElement(PageHeader,{coreStart:core,depsStart:depsStart,fallBackComponent:external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_React_default.a.Fragment,null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_osdSharedDeps_React_default.a.createElement("h1",null,"Query insights - Configuration")),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTabs"],null,tabs.map(renderTab)),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_osdSharedDeps_React_default.a.createElement(Configuration_Configuration,{latencySettings:latencySettings,cpuSettings:cpuSettings,memorySettings:memorySettings,groupBySettings:groupBySettings,dataRetentionSettings:dataRetentionSettings,configInfo:retrieveConfigInfo,core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Redirect"],{to:QUERY_INSIGHTS}))))};var TopNQueries_TopNQueries=TopNQueries;const QueryInsightsDashboardsApp=_ref=>{let{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement}=_ref;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["Route"],{render:()=>external_osdSharedDeps_React_default.a.createElement(TopNQueries_TopNQueries,{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement})})};const renderApp=(core,depsStart,params,dataSourceManagement)=>{external_osdSharedDeps_ReactDom_default.a.render(external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ReactRouterDom_["HashRouter"],null,external_osdSharedDeps_React_default.a.createElement(QueryInsightsDashboardsApp,{core:core,depsStart:depsStart,params:params,dataSourceManagement:dataSourceManagement})),params.element);return()=>external_osdSharedDeps_ReactDom_default.a.unmountComponentAtNode(params.element)}}}]);