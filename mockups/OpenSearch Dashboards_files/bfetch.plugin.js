(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=3)})([function(module,exports){module.exports=__osdSharedDeps__.Rxjs},function(module,exports){module.exports=__osdSharedDeps__.RxjsOperators},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__osdBundles__.get("plugin/opensearchDashboardsUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_bfetch_osd_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4);var _node_modules_val_loader_dist_cjs_js_key_bfetch_osd_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_bfetch_osd_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__osdBundles__.define("plugin/bfetch/public",__webpack_require__,5)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__osdPublicPath__["bfetch"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"BfetchPublicSetup",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"BfetchPublicStart",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"BfetchPublicContract",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"split",(function(){return split}));__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var external_osdSharedDeps_Rxjs_=__webpack_require__(0);var external_osdSharedDeps_RxjsOperators_=__webpack_require__(1);const split=function(){let delimiter=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"\n";return in$=>{const out$=new external_osdSharedDeps_Rxjs_["Subject"];let startingText="";in$.subscribe(chunk=>{const messages=(startingText+chunk).split(delimiter);messages.slice(0,-1).forEach(out$.next.bind(out$));startingText=messages.length?messages[messages.length-1]:""},out$.error.bind(out$),()=>{out$.next(startingText);out$.complete()});return out$.pipe(Object(external_osdSharedDeps_RxjsOperators_["filter"])(Boolean))}};const fromStreamingXhr=xhr=>{const subject=new external_osdSharedDeps_Rxjs_["Subject"];let index=0;const processBatch=()=>{const{responseText:responseText}=xhr;if(index>=responseText.length)return;subject.next(responseText.substr(index));index=responseText.length};xhr.onprogress=processBatch;xhr.onreadystatechange=()=>{processBatch();if(xhr.readyState===4){if(xhr.status===0||xhr.status>=400){subject.error(new Error(`Batch request failed with status ${xhr.status}`))}else{subject.complete()}}};return subject};function fetch_streaming_fetchStreaming(_ref){let{url:url,headers:headers={},method:method="POST",body:body=""}=_ref;const xhr=new window.XMLHttpRequest;xhr.open(method,url);xhr.withCredentials=true;Object.entries(headers).forEach(_ref2=>{let[k,v]=_ref2;return xhr.setRequestHeader(k,v)});const stream=fromStreamingXhr(xhr);xhr.send(body);return{xhr:xhr,stream:stream}}const normalizeError=err=>{if(!err){return{message:"Unknown error."}}if(err instanceof Error){return{message:err.message}}if(typeof err==="object"){return{...err,message:err.message||"Unknown error."}}return{message:String(err)}};const removeLeadingSlash=text=>text[0]==="/"?text.substr(1):text;function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}class ItemBuffer{constructor(params){this.params=params;_defineProperty(this,"list",[])}get length(){return this.list.length}write(item){this.list.push(item);const{flushOnMaxItems:flushOnMaxItems}=this.params;if(flushOnMaxItems){if(this.list.length>=flushOnMaxItems){this.flush()}}}clear(){this.list=[]}flush(){let list;[list,this.list]=[this.list,[]];this.params.onFlush(list)}}function timed_item_buffer_defineProperty(obj,key,value){key=timed_item_buffer_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function timed_item_buffer_toPropertyKey(arg){var key=timed_item_buffer_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}function timed_item_buffer_toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}class timed_item_buffer_TimedItemBuffer extends ItemBuffer{constructor(params){super(params);this.params=params;timed_item_buffer_defineProperty(this,"timer",void 0);timed_item_buffer_defineProperty(this,"onTimeout",()=>{this.flush()})}write(item){super.write(item);if(this.params.maxItemAge&&this.length===1){this.timer=setTimeout(this.onTimeout,this.params.maxItemAge)}}clear(){clearTimeout(this.timer);super.clear()}flush(){clearTimeout(this.timer);super.flush()}}const createBatchedFunction=params=>{const{onCall:onCall,onBatch:onBatch,maxItemAge:maxItemAge=10,flushOnMaxItems:flushOnMaxItems=25}=params;const buffer=new timed_item_buffer_TimedItemBuffer({onFlush:onBatch,maxItemAge:maxItemAge,flushOnMaxItems:flushOnMaxItems});const fn=function(){const[result,batchEntry]=onCall(...arguments);buffer.write(batchEntry);return result};return[fn,buffer]};var public_=__webpack_require__(2);const createStreamingBatchedFunction=params=>{const{url:url,fetchStreaming:fetchStreamingInjected=fetch_streaming_fetchStreaming,flushOnMaxItems:flushOnMaxItems=25,maxItemAge:maxItemAge=10}=params;const[fn]=createBatchedFunction({onCall:payload=>{const future=Object(public_["defer"])();const entry={payload:payload,future:future};return[future.promise,entry]},onBatch:async items=>{try{let responsesReceived=0;const batch=items.map(_ref=>{let{payload:payload}=_ref;return payload});const{stream:stream}=fetchStreamingInjected({url:url,body:JSON.stringify({batch:batch}),method:"POST"});stream.pipe(split("\n")).subscribe({next:json=>{const response=JSON.parse(json);if(response.error){responsesReceived++;items[response.id].future.reject(response.error)}else if(response.result!==undefined){responsesReceived++;items[response.id].future.resolve(response.result)}},error:error=>{const normalizedError=normalizeError(error);normalizedError.code="STREAM";for(const{future:future}of items)future.reject(normalizedError)},complete:()=>{const streamTerminatedPrematurely=responsesReceived!==items.length;if(streamTerminatedPrematurely){const error={message:"Connection terminated prematurely.",code:"CONNECTION"};for(const{future:future}of items)future.reject(error)}}});await stream.toPromise()}catch(error){for(const item of items)item.future.reject(error)}},flushOnMaxItems:flushOnMaxItems,maxItemAge:maxItemAge});return fn};function plugin_defineProperty(obj,key,value){key=plugin_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function plugin_toPropertyKey(arg){var key=plugin_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}function plugin_toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}class plugin_BfetchPublicPlugin{constructor(initializerContext){this.initializerContext=initializerContext;plugin_defineProperty(this,"contract",void 0);plugin_defineProperty(this,"fetchStreaming",(version,basePath)=>params=>fetch_streaming_fetchStreaming({...params,url:`${basePath}/${removeLeadingSlash(params.url)}`,headers:{"Content-Type":"application/json","osd-xsrf":"osd-bfetch","osd-version":version,...params.headers||{}}}));plugin_defineProperty(this,"batchedFunction",fetchStreaming=>params=>createStreamingBatchedFunction({...params,fetchStreaming:params.fetchStreaming||fetchStreaming}))}setup(core,plugins){const{version:version}=this.initializerContext.env.packageInfo;const basePath=core.http.basePath.get();const fetchStreaming=this.fetchStreaming(version,basePath);const batchedFunction=this.batchedFunction(fetchStreaming);this.contract={fetchStreaming:fetchStreaming,batchedFunction:batchedFunction};return this.contract}start(core,plugins){return this.contract}stop(){}}function public_plugin(initializerContext){return new plugin_BfetchPublicPlugin(initializerContext)}}]);