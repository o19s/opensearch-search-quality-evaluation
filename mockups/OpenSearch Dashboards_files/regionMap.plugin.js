(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}}var installedModules={};var installedChunks={0:0};function jsonpScriptSrc(chunkId){return __webpack_require__.p+"regionMap.chunk."+chunkId+".js"}function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.e=function requireEnsure(chunkId){var promises=[];var installedChunkData=installedChunks[chunkId];if(installedChunkData!==0){if(installedChunkData){promises.push(installedChunkData[2])}else{var promise=new Promise((function(resolve,reject){installedChunkData=installedChunks[chunkId]=[resolve,reject]}));promises.push(installedChunkData[2]=promise);var script=document.createElement("script");var onScriptComplete;script.charset="utf-8";script.timeout=120;if(__webpack_require__.nc){script.setAttribute("nonce",__webpack_require__.nc)}script.src=jsonpScriptSrc(chunkId);var error=new Error;onScriptComplete=function(event){script.onerror=script.onload=null;clearTimeout(timeout);var chunk=installedChunks[chunkId];if(chunk!==0){if(chunk){var errorType=event&&(event.type==="load"?"missing":event.type);var realSrc=event&&event.target&&event.target.src;error.message="Loading chunk "+chunkId+" failed.\n("+errorType+": "+realSrc+")";error.name="ChunkLoadError";error.type=errorType;error.request=realSrc;chunk[1](error)}installedChunks[chunkId]=undefined}};var timeout=setTimeout((function(){onScriptComplete({type:"timeout",target:script})}),12e4);script.onerror=script.onload=onScriptComplete;document.head.appendChild(script)}}return Promise.all(promises)};__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";__webpack_require__.oe=function(err){console.error(err);throw err};var jsonpArray=window["regionMap_bundle_jsonpfunction"]=window["regionMap_bundle_jsonpfunction"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;return __webpack_require__(__webpack_require__.s=13)})([function(module,exports){module.exports=__osdSharedDeps__.React},function(module,exports){module.exports=__osdSharedDeps__.ElasticEui},function(module,exports){module.exports=__osdSharedDeps__.OsdI18n},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__osdBundles__.get("plugin/charts/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__osdBundles__.get("plugin/mapsLegacy/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return DEFAULT_MAP_CHOICE}));__webpack_require__.d(__webpack_exports__,"a",(function(){return CUSTOM_MAP_CHOICE}));__webpack_require__.d(__webpack_exports__,"b",(function(){return CUSTOM_VECTOR_MAP_MAX_SIZE_SETTING}));const DEFAULT_MAP_CHOICE="default";const CUSTOM_MAP_CHOICE="custom";const CUSTOM_VECTOR_MAP_MAX_SIZE_SETTING="visualization:regionmap:customVectorMapMaxSize"},function(module,exports,__webpack_require__){"use strict";module.exports=function(cssWithMappingToString){var list=[];list.toString=function toString(){return this.map((function(item){var content=cssWithMappingToString(item);if(item[2]){return"@media ".concat(item[2]," {").concat(content,"}")}return content})).join("")};list.i=function(modules,mediaQuery,dedupe){if(typeof modules==="string"){modules=[[null,modules,""]]}var alreadyImportedModules={};if(dedupe){for(var i=0;i<this.length;i++){var id=this[i][0];if(id!=null){alreadyImportedModules[id]=true}}}for(var _i=0;_i<modules.length;_i++){var item=[].concat(modules[_i]);if(dedupe&&alreadyImportedModules[item[0]]){continue}if(mediaQuery){if(!item[2]){item[2]=mediaQuery}else{item[2]="".concat(mediaQuery," and ").concat(item[2])}}list.push(item)}};return list}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return setCoreService}));__webpack_require__.d(__webpack_exports__,"a",(function(){return getFormatService}));__webpack_require__.d(__webpack_exports__,"e",(function(){return setFormatService}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getNotifications}));__webpack_require__.d(__webpack_exports__,"f",(function(){return setNotifications}));__webpack_require__.d(__webpack_exports__,"h",(function(){return setQueryService}));__webpack_require__.d(__webpack_exports__,"i",(function(){return setShareService}));__webpack_require__.d(__webpack_exports__,"c",(function(){return getOpenSearchDashboardsLegacy}));__webpack_require__.d(__webpack_exports__,"g",(function(){return setOpenSearchDashboardsLegacy}));var _opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);var _opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__);const[getCoreService,setCoreService]=Object(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Core");const[getFormatService,setFormatService]=Object(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("data.fieldFormats");const[getNotifications,setNotifications]=Object(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Notifications");const[getQueryService,setQueryService]=Object(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Query");const[getShareService,setShareService]=Object(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("Share");const[getOpenSearchDashboardsLegacy,setOpenSearchDashboardsLegacy]=Object(_opensearch_dashboards_utils_public__WEBPACK_IMPORTED_MODULE_0__["createGetterSetter"])("OpenSearchDashboardsLegacy")},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__osdBundles__.get("plugin/opensearchDashboardsUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports,__webpack_require__){"use strict";var isOldIE=function isOldIE(){var memo;return function memorize(){if(typeof memo==="undefined"){memo=Boolean(window&&document&&document.all&&!window.atob)}return memo}}();var getTarget=function getTarget(){var memo={};return function memorize(target){if(typeof memo[target]==="undefined"){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement){try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}}memo[target]=styleTarget}return memo[target]}}();var stylesInDom=[];function getIndexByIdentifier(identifier){var result=-1;for(var i=0;i<stylesInDom.length;i++){if(stylesInDom[i].identifier===identifier){result=i;break}}return result}function modulesToDom(list,options){var idCountMap={};var identifiers=[];for(var i=0;i<list.length;i++){var item=list[i];var id=options.base?item[0]+options.base:item[0];var count=idCountMap[id]||0;var identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var index=getIndexByIdentifier(identifier);var obj={css:item[1],media:item[2],sourceMap:item[3]};if(index!==-1){stylesInDom[index].references++;stylesInDom[index].updater(obj)}else{stylesInDom.push({identifier:identifier,updater:addStyle(obj,options),references:1})}identifiers.push(identifier)}return identifiers}function insertStyleElement(options){var style=document.createElement("style");var attributes=options.attributes||{};if(typeof attributes.nonce==="undefined"){var nonce=true?__webpack_require__.nc:undefined;if(nonce){attributes.nonce=nonce}}Object.keys(attributes).forEach((function(key){style.setAttribute(key,attributes[key])}));if(typeof options.insert==="function"){options.insert(style)}else{var target=getTarget(options.insert||"head");if(!target){throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.")}target.appendChild(style)}return style}function removeStyleElement(style){if(style.parentNode===null){return false}style.parentNode.removeChild(style)}var replaceText=function replaceText(){var textStore=[];return function replace(index,replacement){textStore[index]=replacement;return textStore.filter(Boolean).join("\n")}}();function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.media?"@media ".concat(obj.media," {").concat(obj.css,"}"):obj.css;if(style.styleSheet){style.styleSheet.cssText=replaceText(index,css)}else{var cssNode=document.createTextNode(css);var childNodes=style.childNodes;if(childNodes[index]){style.removeChild(childNodes[index])}if(childNodes.length){style.insertBefore(cssNode,childNodes[index])}else{style.appendChild(cssNode)}}}function applyToTag(style,options,obj){var css=obj.css;var media=obj.media;var sourceMap=obj.sourceMap;if(media){style.setAttribute("media",media)}else{style.removeAttribute("media")}if(sourceMap&&typeof btoa!=="undefined"){css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")}if(style.styleSheet){style.styleSheet.cssText=css}else{while(style.firstChild){style.removeChild(style.firstChild)}style.appendChild(document.createTextNode(css))}}var singleton=null;var singletonCounter=0;function addStyle(obj,options){var style;var update;var remove;if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=insertStyleElement(options));update=applyToSingletonTag.bind(null,style,styleIndex,false);remove=applyToSingletonTag.bind(null,style,styleIndex,true)}else{style=insertStyleElement(options);update=applyToTag.bind(null,style,options);remove=function remove(){removeStyleElement(style)}}update(obj);return function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap){return}update(obj=newObj)}else{remove()}}}module.exports=function(list,options){options=options||{};if(!options.singleton&&typeof options.singleton!=="boolean"){options.singleton=isOldIE()}list=list||[];var lastIdentifiers=modulesToDom(list,options);return function update(newList){newList=newList||[];if(Object.prototype.toString.call(newList)!=="[object Array]"){return}for(var i=0;i<lastIdentifiers.length;i++){var identifier=lastIdentifiers[i];var index=getIndexByIdentifier(identifier);stylesInDom[index].references--}var newLastIdentifiers=modulesToDom(newList,options);for(var _i=0;_i<lastIdentifiers.length;_i++){var _identifier=lastIdentifiers[_i];var _index=getIndexByIdentifier(_identifier);if(stylesInDom[_index].references===0){stylesInDom[_index].updater();stylesInDom.splice(_index,1)}}lastIdentifiers=newLastIdentifiers}}},function(module,exports){module.exports=__osdSharedDeps__.OsdI18nReact},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getServices}));function getServices(http){return{getCustomIndices:async dataSourceRefId=>{try{return await http.post("../api/geospatial/_indices",{body:JSON.stringify({index:"*-map"}),query:{dataSourceId:dataSourceRefId}})}catch(e){return e}},getIndexData:async(indexName,size,dataSourceRefId)=>{try{return await http.post("../api/geospatial/_search",{body:JSON.stringify({index:indexName,size:size}),query:{dataSourceId:dataSourceRefId}})}catch(e){return e}},getIndexMapping:async(indexName,dataSourceRefId)=>{try{return await http.post("../api/geospatial/_mappings",{body:JSON.stringify({index:indexName}),query:{dataSourceId:dataSourceRefId}})}catch(e){return e}}}}},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__osdBundles__.get("plugin/visDefaultEditor/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_regionMap_osd_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(14);var _node_modules_val_loader_dist_cjs_js_key_regionMap_osd_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_regionMap_osd_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__osdBundles__.define("plugin/regionMap/public",__webpack_require__,28)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__osdPublicPath__["regionMap"]},function(module,exports,__webpack_require__){switch(window.__osdThemeTag__){case"v7dark":return __webpack_require__(16);case"v7light":return __webpack_require__(18);case"v8dark":return __webpack_require__(20);case"v8light":return __webpack_require__(22);case"v9dark":return __webpack_require__(24);case"v9light":return __webpack_require__(26)}},function(module,exports,__webpack_require__){var api=__webpack_require__(9);var content=__webpack_require__(17);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);var ___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()((function(i){return i[1]}));___CSS_LOADER_EXPORT___.push([module.i,"/*!\n * SPDX-License-Identifier: Apache-2.0\n *\n * The OpenSearch Contributors require contributions made to\n * this file be licensed under the Apache-2.0 license or a\n * compatible open source license.\n *\n * Modifications Copyright OpenSearch Contributors. See\n * GitHub history for details.\n */\n\n.mapChoiceGroup{font-size:small}\n",""]);__webpack_exports__["default"]=___CSS_LOADER_EXPORT___},function(module,exports,__webpack_require__){var api=__webpack_require__(9);var content=__webpack_require__(19);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);var ___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()((function(i){return i[1]}));___CSS_LOADER_EXPORT___.push([module.i,"/*!\n * SPDX-License-Identifier: Apache-2.0\n *\n * The OpenSearch Contributors require contributions made to\n * this file be licensed under the Apache-2.0 license or a\n * compatible open source license.\n *\n * Modifications Copyright OpenSearch Contributors. See\n * GitHub history for details.\n */\n\n.mapChoiceGroup{font-size:small}\n",""]);__webpack_exports__["default"]=___CSS_LOADER_EXPORT___},function(module,exports,__webpack_require__){var api=__webpack_require__(9);var content=__webpack_require__(21);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);var ___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()((function(i){return i[1]}));___CSS_LOADER_EXPORT___.push([module.i,"/*!\n * SPDX-License-Identifier: Apache-2.0\n *\n * The OpenSearch Contributors require contributions made to\n * this file be licensed under the Apache-2.0 license or a\n * compatible open source license.\n *\n * Modifications Copyright OpenSearch Contributors. See\n * GitHub history for details.\n */\n\n.mapChoiceGroup{font-size:small}\n",""]);__webpack_exports__["default"]=___CSS_LOADER_EXPORT___},function(module,exports,__webpack_require__){var api=__webpack_require__(9);var content=__webpack_require__(23);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);var ___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()((function(i){return i[1]}));___CSS_LOADER_EXPORT___.push([module.i,"/*!\n * SPDX-License-Identifier: Apache-2.0\n *\n * The OpenSearch Contributors require contributions made to\n * this file be licensed under the Apache-2.0 license or a\n * compatible open source license.\n *\n * Modifications Copyright OpenSearch Contributors. See\n * GitHub history for details.\n */\n\n.mapChoiceGroup{font-size:small}\n",""]);__webpack_exports__["default"]=___CSS_LOADER_EXPORT___},function(module,exports,__webpack_require__){var api=__webpack_require__(9);var content=__webpack_require__(25);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);var ___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()((function(i){return i[1]}));___CSS_LOADER_EXPORT___.push([module.i,"/*!\n * SPDX-License-Identifier: Apache-2.0\n *\n * The OpenSearch Contributors require contributions made to\n * this file be licensed under the Apache-2.0 license or a\n * compatible open source license.\n *\n * Modifications Copyright OpenSearch Contributors. See\n * GitHub history for details.\n */\n\n.mapChoiceGroup{font-size:small}\n",""]);__webpack_exports__["default"]=___CSS_LOADER_EXPORT___},function(module,exports,__webpack_require__){var api=__webpack_require__(9);var content=__webpack_require__(27);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0__);var ___CSS_LOADER_EXPORT___=_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_0___default()((function(i){return i[1]}));___CSS_LOADER_EXPORT___.push([module.i,"/*!\n * SPDX-License-Identifier: Apache-2.0\n *\n * The OpenSearch Contributors require contributions made to\n * this file be licensed under the Apache-2.0 license or a\n * compatible open source license.\n *\n * Modifications Copyright OpenSearch Contributors. See\n * GitHub history for details.\n */\n\n.mapChoiceGroup{font-size:small}\n",""]);__webpack_exports__["default"]=___CSS_LOADER_EXPORT___},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));__webpack_require__.d(__webpack_exports__,"RegionMapPluginSetup",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"RegionMapVisualizationDependencies",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"RegionMapOptionsProps",(function(){return undefined}));var external_osdSharedDeps_OsdI18n_=__webpack_require__(2);const createRegionMapFn=()=>({name:"regionmap",type:"render",context:{types:["opensearch_dashboards_datatable"]},help:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.function.help",{defaultMessage:"Regionmap visualization"}),args:{visConfig:{types:["string","null"],default:'"{}"'}},fn(context,args){const visConfig=JSON.parse(args.visConfig);return{type:"render",as:"visualization",value:{visData:context,visType:"region_map",visConfig:visConfig,params:{listenOnChange:true}}}}});var external_osdSharedDeps_React_=__webpack_require__(0);var external_osdSharedDeps_React_default=__webpack_require__.n(external_osdSharedDeps_React_);var public_=__webpack_require__(4);const mapToLayerWithId=(prefix,layer)=>({...layer,layerId:`${prefix}.${layer.name}`,isEMS:public_["ORIGIN"].EMS===prefix});var opensearch_dashboards_services=__webpack_require__(7);var charts_public_=__webpack_require__(3);function tooltipFormatter(metric,fieldFormatter,fieldName,metricName){if(!metric){return""}const details=[];if(fieldName&&metric){details.push({label:fieldName,value:metric.term})}if(metric){details.push({label:metricName,value:fieldFormatter?fieldFormatter.convert(metric.value,"text"):metric.value})}return details}var common=__webpack_require__(5);function createRegionMapVisualization(_ref){let{http:http,regionmapsConfig:regionmapsConfig,uiSettings:uiSettings,BaseMapsVisualization:BaseMapsVisualization,getServiceSettings:getServiceSettings}=_ref;return class RegionMapsVisualization extends BaseMapsVisualization{constructor(container,vis){super(container,vis);this._vis=this.vis;this._choroplethLayer=null;this._tooltipFormatter=Object(public_["mapTooltipProvider"])(container,tooltipFormatter)}async render(opensearchResponse,visParams){var _this$_choroplethLaye,_this$_choroplethLaye2;Object(opensearch_dashboards_services["c"])().loadFontAwesome();(_this$_choroplethLaye=this._choroplethLayer)===null||_this$_choroplethLaye===void 0||_this$_choroplethLaye.setLayerChosenByUser(visParams.layerChosenByUser);(_this$_choroplethLaye2=this._choroplethLayer)===null||_this$_choroplethLaye2===void 0||_this$_choroplethLaye2.setVisParams(visParams);await super.render(opensearchResponse,visParams);if(this._choroplethLayer){this._choroplethLayer.setLayerChosenByUser(visParams.layerChosenByUser);this._choroplethLayer.setVisParams(visParams);await this._choroplethLayer.whenDataLoaded()}}async _updateData(table){this._chartData=table;const termColumn=this._params.bucket?table.columns[this._params.bucket.accessor]:null;const valueColumn=table.columns[this._params.metric.accessor];let results;if(!this._hasColumns()||!table.rows.length){results=[]}else{results=table.rows.map(row=>{const term=row[termColumn.id];const value=row[valueColumn.id];return{term:term,value:value}})}let selectedLayer;if(common["c"]===this._params.layerChosenByUser){var _selectedLayer;selectedLayer=await this._loadConfig(this._params.selectedLayer);this._params.selectedJoinField=(_selectedLayer=selectedLayer)===null||_selectedLayer===void 0?void 0:_selectedLayer.fields[0]}else{selectedLayer=this._params.selectedCustomLayer;this._params.selectedJoinField=this._params.selectedCustomJoinField}if(!this._params.selectedJoinField&&selectedLayer){this._params.selectedJoinField=selectedLayer.fields[0]}if(!selectedLayer){return}await this._updateChoroplethLayerForNewMetrics(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes,results);const metricFieldFormatter=Object(opensearch_dashboards_services["a"])().deserialize(this._params.metric.format);this._choroplethLayer.setMetrics(results,metricFieldFormatter,valueColumn.name);if(termColumn&&valueColumn){this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,termColumn.name,valueColumn.name)}this._opensearchDashboardsMap.useUiStateFromVisualization(this._vis)}async _loadConfig(fileLayerConfig){const{escape:escape}=await Promise.resolve().then(__webpack_require__.t.bind(null,29,7));if(fileLayerConfig&&(fileLayerConfig.isEMS||fileLayerConfig.layerId&&fileLayerConfig.layerId.startsWith(`${public_["ORIGIN"].EMS}.`))){const serviceSettings=await getServiceSettings();return await serviceSettings.loadFileLayerConfig(fileLayerConfig)}const configuredLayer=regionmapsConfig.layers.find(layer=>layer.name===fileLayerConfig.name);if(configuredLayer){return{...configuredLayer,attribution:escape(configuredLayer.attribution?configuredLayer.attribution:"")}}return null}async _updateParams(){await super._updateParams();let selectedLayer;if(common["c"]===this._params.layerChosenByUser&&this._params.selectedLayer){selectedLayer=await this._loadConfig(this._params.selectedLayer)}else if(common["a"]===this._params.layerChosenByUser&&this._params.selectedCustomLayer){var _this$_params;selectedLayer=this._params.selectedCustomLayer;this._params.selectedJoinField=(_this$_params=this._params)===null||_this$_params===void 0?void 0:_this$_params.selectedCustomJoinField}if(!this._params.selectedJoinField&&selectedLayer){this._params.selectedJoinField=selectedLayer.fields[0]}if(!this._params.selectedJoinField||!selectedLayer){return}await this._updateChoroplethLayerForNewProperties(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes);const metricFieldFormatter=Object(opensearch_dashboards_services["a"])().deserialize(this._params.metric.format);this._choroplethLayer.setLayerChosenByUser(this._params.layerChosenByUser);this._choroplethLayer.setJoinField(this._params.selectedJoinField.name);this._choroplethLayer.setColorRamp(charts_public_["truncatedColorMaps"][this._params.colorSchema].value);this._choroplethLayer.setLineWeight(this._params.outlineWeight);this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,this._metricLabel)}async _updateChoroplethLayerForNewMetrics(name,attribution,showAllData,newMetrics){this._choroplethLayer.setLayerChosenByUser(this._params.layerChosenByUser);if(this._choroplethLayer&&this._choroplethLayer.canReuseInstanceForNewMetrics(name,showAllData,newMetrics)){return}await this._recreateChoroplethLayer(name,attribution,showAllData)}async _updateChoroplethLayerForNewProperties(name,attribution,showAllData){if(this._choroplethLayer&&this._choroplethLayer.canReuseInstance(name,showAllData)){return}await this._recreateChoroplethLayer(name,attribution,showAllData)}async _recreateChoroplethLayer(name,attribution,showAllData){const selectedLayer=common["c"]===this._params.layerChosenByUser?await this._loadConfig(this._params.selectedLayer):this._params.selectedCustomLayer;this._opensearchDashboardsMap.removeLayer(this._choroplethLayer);if(this._choroplethLayer){this._choroplethLayer=this._choroplethLayer.cloneChoroplethLayerForNewData(name,attribution,selectedLayer.format,showAllData,selectedLayer.meta,selectedLayer,await getServiceSettings(),(await Object(public_["lazyLoadMapsLegacyModules"])()).L,this._params.layerChosenByUser,http,uiSettings,this.vis.type.editorConfig.collections.dataSourceRefId)}else{const{ChoroplethLayer:ChoroplethLayer}=await Promise.all([__webpack_require__.e(1),__webpack_require__.e(2)]).then(__webpack_require__.bind(null,34));this._choroplethLayer=new ChoroplethLayer(name,attribution,selectedLayer.format,showAllData,selectedLayer.meta,selectedLayer,await getServiceSettings(),(await Object(public_["lazyLoadMapsLegacyModules"])()).L,this._params.layerChosenByUser,http,uiSettings,this.vis.type.editorConfig.collections.dataSourceRefId)}this._choroplethLayer.setLayerChosenByUser(this._params.layerChosenByUser);this._choroplethLayer.on("select",event=>{const{rows:rows,columns:columns}=this._chartData;const rowIndex=rows.findIndex(row=>row[columns[0].id]===event);this._vis.API.events.filter({table:this._chartData,column:0,row:rowIndex,value:event})});this._choroplethLayer.on("styleChanged",event=>{const shouldShowWarning=this._params.isDisplayWarning&&uiSettings.get("visualization:regionmap:showWarnings");if(event.mismatches.length>0&&shouldShowWarning){Object(opensearch_dashboards_services["b"])().toasts.addWarning({title:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visualization.unableToShowMismatchesWarningTitle",{defaultMessage:"Unable to show {mismatchesLength} {oneMismatch, plural, one {result} other {results}} on map",values:{mismatchesLength:event.mismatches.length,oneMismatch:event.mismatches.length>1?0:1}}),text:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visualization.unableToShowMismatchesWarningText",{defaultMessage:"Ensure that each of these term matches a shape on that shape's join field: {mismatches}",values:{mismatches:event.mismatches?event.mismatches.join(", "):""}})})}});this._opensearchDashboardsMap.addLayer(this._choroplethLayer)}_hasColumns(){return this._chartData&&this._chartData.columns.length===2}}}var external_osdSharedDeps_ElasticEui_=__webpack_require__(1);var external_osdSharedDeps_OsdI18nReact_=__webpack_require__(10);const mapLayerForOption=_ref=>{let{layerId:layerId,name:name}=_ref;return{text:name,value:layerId}};const mapFieldForOption=_ref2=>{let{description:description,name:name}=_ref2;return{text:description,value:name}};function DefaultMapOptions(props){const{getServiceSettings:getServiceSettings,stateParams:stateParams,vis:vis,setValue:setValue}=props;const vectorLayers=vis.type.editorConfig.collections.vectorLayers;const vectorLayerOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>vectorLayers.map(mapLayerForOption),[vectorLayers]);const fieldOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>(stateParams.selectedLayer&&stateParams.selectedLayer.fields||[]).map(mapFieldForOption),[stateParams.selectedLayer]);const setEmsHotLink=Object(external_osdSharedDeps_React_["useCallback"])(async layer=>{const serviceSettings=await getServiceSettings();const emsHotLink=await serviceSettings.getEMSHotLink(layer);setValue("emsHotLink",emsHotLink)},[setValue,getServiceSettings]);const setLayer=Object(external_osdSharedDeps_React_["useCallback"])(async(paramName,value)=>{const newLayer=vectorLayers.find(_ref3=>{let{layerId:layerId}=_ref3;return layerId===value});if(newLayer){setValue(paramName,newLayer);setValue("selectedJoinField",newLayer.fields[0]);setEmsHotLink(newLayer)}},[vectorLayers,setEmsHotLink,setValue]);const setField=Object(external_osdSharedDeps_React_["useCallback"])((paramName,value)=>{if(stateParams.selectedLayer){setValue(paramName,stateParams.selectedLayer.fields.find(f=>f.name===value))}},[setValue,stateParams.selectedLayer]);return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"regionMap.visParams.layerSettingsTitle",defaultMessage:"Layer settings"}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{id:"defaultMapSelection",direction:"column"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsSelectLayer",label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.vectorMapLabel",{defaultMessage:"Vector map"}),options:vectorLayerOptions,paramName:"selectedLayer",value:stateParams.selectedLayer&&stateParams.selectedLayer.layerId,setValue:setLayer})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsSelectJoinField",label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.joinFieldLabel",{defaultMessage:"Join field"}),options:fieldOptions,paramName:"selectedJoinField",value:stateParams.selectedJoinField&&stateParams.selectedJoinField.name,setValue:setField}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(charts_public_["SwitchOption"],{label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.displayWarningsLabel",{defaultMessage:"Display warnings"}),tooltip:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.switchWarningsTipText",{defaultMessage:"Turns on/off warnings. When turned on, warning will be shown for each term that cannot be matched to a shape in the vector layer based on the join field. When turned off, these warnings will be turned off."}),paramName:"isDisplayWarning",value:stateParams.isDisplayWarning,setValue:setValue}),external_osdSharedDeps_React_default.a.createElement(charts_public_["SwitchOption"],{label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.showAllShapesLabel",{defaultMessage:"Show all shapes"}),tooltip:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.turnOffShowingAllShapesTipText",{defaultMessage:"Turning this off only shows the shapes that were matched with a corresponding term."}),paramName:"showAllShapes",value:stateParams.showAllShapes,setValue:setValue}))}var map_choice_options=__webpack_require__(15);const map_choice_options_mapLayerForOption=_ref=>{let{layerId:layerId,name:name}=_ref;return{text:name,value:layerId}};const map_choice_options_mapFieldForOption=_ref2=>{let{description:description,name:name}=_ref2;return{text:description,value:name}};const mapCustomJoinFieldForOption=_ref3=>{let{description:description,name:name}=_ref3;return{label:name,text:description,value:name}};function MapChoiceOptions(props){const{getServiceSettings:getServiceSettings,stateParams:stateParams,vis:vis,setValue:setValue}=props;const vectorLayers=vis.type.editorConfig.collections.vectorLayers;const customVectorLayers=vis.type.editorConfig.collections.customVectorLayers;const vectorLayerOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>vectorLayers.map(map_choice_options_mapLayerForOption),[vectorLayers]);const customVectorLayerOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>customVectorLayers.map(map_choice_options_mapLayerForOption),[customVectorLayers]);const fieldOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>(stateParams.selectedLayer&&stateParams.selectedLayer.fields||[]).map(map_choice_options_mapFieldForOption),[stateParams.selectedLayer]);const customFieldOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>(stateParams.selectedCustomLayer&&stateParams.selectedCustomLayer.fields||[]).map(mapCustomJoinFieldForOption),[stateParams.selectedCustomLayer]);const selectDefaultVectorMap=()=>{setValue("layerChosenByUser",common["c"])};const selectCustomVectorMap=()=>{setValue("layerChosenByUser",common["a"])};const setEmsHotLink=Object(external_osdSharedDeps_React_["useCallback"])(async layer=>{const serviceSettings=await getServiceSettings();const emsHotLink=await serviceSettings.getEMSHotLink(layer);setValue("emsHotLink",emsHotLink)},[setValue,getServiceSettings]);const setLayer=Object(external_osdSharedDeps_React_["useCallback"])(async(paramName,value)=>{const newLayer=vectorLayers.find(_ref4=>{let{layerId:layerId}=_ref4;return layerId===value});if(newLayer){setValue(paramName,newLayer);setValue("selectedJoinField",newLayer.fields[0]);setEmsHotLink(newLayer)}},[vectorLayers,setEmsHotLink,setValue]);const setCustomLayer=Object(external_osdSharedDeps_React_["useCallback"])(async(paramName,value)=>{const newLayer=customVectorLayers.find(_ref5=>{let{layerId:layerId}=_ref5;return layerId===value});if(newLayer){setValue(paramName,newLayer);setValue("selectedJoinField",newLayer.fields[0])}},[customVectorLayers,setValue]);const setCustomJoinField=Object(external_osdSharedDeps_React_["useCallback"])(async(paramName,value)=>{if(stateParams.selectedCustomLayer){setValue(paramName,stateParams.selectedCustomLayer.fields.find(f=>f.name===value))}},[setValue,stateParams.selectedCustomLayer]);const setField=Object(external_osdSharedDeps_React_["useCallback"])((paramName,value)=>{if(stateParams.selectedLayer){setValue(paramName,stateParams.selectedLayer.fields.find(f=>f.name===value))}},[setValue,stateParams.selectedLayer]);return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("h2",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"regionMap.visParams.layerSettingsTitle",defaultMessage:"Layer settings"}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_osdSharedDeps_React_default.a.createElement("strong",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTextColor"],{color:"default"},"Choose a vector map layer"))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{className:"mapChoiceGroup"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCheckableCard"],{id:"defaultVectorMap","data-test-subj":"defaultVectorMap",label:"Default vector map",name:"defaultVectorMap",value:"default",checked:common["c"]===stateParams.layerChosenByUser,onChange:selectDefaultVectorMap})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiCheckableCard"],{id:"customVectorMap","data-test-subj":"customVectorMap",label:"Custom vector map",name:"customVectorMap",value:"custom",checked:common["a"]===stateParams.layerChosenByUser,onChange:selectCustomVectorMap}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),common["c"]===stateParams.layerChosenByUser?external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{id:"defaultMapSelection",direction:"column"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsSelectLayer",label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.vectorMapLabel",{defaultMessage:"Vector map"}),options:vectorLayerOptions,paramName:"selectedLayer",value:stateParams.selectedLayer&&stateParams.selectedLayer.layerId,setValue:setLayer})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsSelectJoinField",label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.joinFieldLabel",{defaultMessage:"Join field"}),options:fieldOptions,paramName:"selectedJoinField",value:stateParams.selectedJoinField&&stateParams.selectedJoinField.name,setValue:setField}))):external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexGroup"],{id:"customMapSelection",direction:"column"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsCustomSelectLayer",label:"Vector map",options:customVectorLayerOptions,paramName:"selectedCustomLayer",value:stateParams.selectedCustomLayer&&stateParams.selectedCustomLayer.layerId,setValue:setCustomLayer})),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{id:"regionMapOptionsCustomSelectJoinField",label:"Join field",options:customFieldOptions,paramName:"selectedCustomJoinField",value:stateParams.selectedCustomJoinField&&stateParams.selectedCustomJoinField.name,setValue:setCustomJoinField}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_osdSharedDeps_React_default.a.createElement(charts_public_["SwitchOption"],{label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.displayWarningsLabel",{defaultMessage:"Display warnings"}),tooltip:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.switchWarningsTipText",{defaultMessage:"Turns on/off warnings. When turned on, warning will be shown for each term that cannot be matched to a shape in the vector layer based on the join field. When turned off, these warnings will be turned off."}),paramName:"isDisplayWarning",value:stateParams.isDisplayWarning,setValue:setValue}),external_osdSharedDeps_React_default.a.createElement(charts_public_["SwitchOption"],{label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.showAllShapesLabel",{defaultMessage:"Show all shapes"}),tooltip:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.turnOffShowingAllShapesTipText",{defaultMessage:"Turning this off only shows the shapes that were matched with a corresponding term."}),paramName:"showAllShapes",value:stateParams.showAllShapes,setValue:setValue}))}function StyleOptions(props){const{stateParams:stateParams,vis:vis,setValue:setValue}=props;return external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"s"},external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiTitle"],{size:"xs",id:"styleSettingTitleId"},external_osdSharedDeps_React_default.a.createElement("h2",null,external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_OsdI18nReact_["FormattedMessage"],{id:"regionMap.visParams.styleSettingsLabel",defaultMessage:"Style settings"}))),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(charts_public_["SelectOption"],{label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.colorSchemaLabel",{defaultMessage:"Color schema"}),options:vis.type.editorConfig.collections.colorSchemas,paramName:"colorSchema",value:stateParams.colorSchema,setValue:setValue,id:"colorSchemaId"}),external_osdSharedDeps_React_default.a.createElement(charts_public_["NumberInputOption"],{label:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.visParams.outlineWeightLabel",{defaultMessage:"Border thickness"}),min:0,paramName:"outlineWeight",value:stateParams.outlineWeight,setValue:setValue,id:"borderThicknessId"}))}const region_map_options_mapLayerForOption=_ref=>{let{layerId:layerId,name:name}=_ref;return{text:name,value:layerId}};function RegionMapOptions(props){const customVectorLayers=props.vis.type.editorConfig.collections.customVectorLayers;const customVectorLayerOptions=Object(external_osdSharedDeps_React_["useMemo"])(()=>customVectorLayers.map(region_map_options_mapLayerForOption),[customVectorLayers]);if(customVectorLayerOptions.length===0){return external_osdSharedDeps_React_default.a.createElement("div",{id:"defaultMapOption"},external_osdSharedDeps_React_default.a.createElement(DefaultMapOptions,props),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(StyleOptions,props),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(public_["WmsOptions"],props))}else{return external_osdSharedDeps_React_default.a.createElement("div",{id:"customMapOption"},external_osdSharedDeps_React_default.a.createElement(MapChoiceOptions,props),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(StyleOptions,props),external_osdSharedDeps_React_default.a.createElement(external_osdSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_osdSharedDeps_React_default.a.createElement(public_["WmsOptions"],props))}}var visDefaultEditor_public_=__webpack_require__(12);var public_services=__webpack_require__(11);function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function createRegionMapTypeDefinition(dependencies){const{http:http,uiSettings:uiSettings,regionmapsConfig:regionmapsConfig,getServiceSettings:getServiceSettings,additionalOptions:additionalOptions}=dependencies;const services=Object(public_services["a"])(http);const visualization=createRegionMapVisualization(dependencies);const diffArray=(arr1,arr2)=>arr1.concat(arr2).filter(item=>!arr1.includes(item)||!arr2.includes(item));const getCustomIndices=async dataSourceRefId=>{try{const result=await services.getCustomIndices(dataSourceRefId);return result.resp}catch(e){return false}};const getJoinFields=async(indexName,dataSourceRefId)=>{try{const result=await services.getIndexMapping(indexName,dataSourceRefId);const properties=diffArray(Object.keys(result.resp[indexName].mappings.properties),["location"]);return properties.map((function(property){return{type:"id",name:property,description:property}}))}catch(e){return false}};const addSchemaToCustomLayer=async(customlayer,dataSourceRefId)=>{const joinFields=await getJoinFields(customlayer,dataSourceRefId);const customLayerWithSchema={attribution:'<a rel="noreferrer noopener" href="http://www.naturalearthdata.com/about/terms-of-use">Made with NaturalEarth</a>',created_at:"2017-04-26T17:12:15.978370",format:"geojson",fields:joinFields,id:customlayer,meta:undefined,name:customlayer,origin:"user-upload"};return customLayerWithSchema};return{name:"region_map",title:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.mapVis.regionMapTitle",{defaultMessage:"Region Map"}),description:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.mapVis.regionMapDescription",{defaultMessage:"Show metrics on a thematic map. Use one of the provided base maps, or add your own. Darker colors represent higher values."}),icon:"visMapRegion",visConfig:{defaults:{layerChosenByUser:common["c"],legendPosition:"bottomright",addTooltip:true,colorSchema:"Yellow to Red",emsHotLink:"",isDisplayWarning:true,wms:uiSettings.get("visualization:tileMap:WMSdefaults"),mapZoom:2,mapCenter:[0,0],outlineWeight:1,showAllShapes:true}},visualization:visualization,editorConfig:{optionTabs:()=>[{name:"options",title:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.mapVis.regionMapEditorConfig.optionTabs.optionsTitle",{defaultMessage:"Layer Options"}),editor:props=>external_osdSharedDeps_React_default.a.createElement(RegionMapOptions,_extends({},props,{getServiceSettings:getServiceSettings}))},...additionalOptions],collections:{colorSchemas:charts_public_["truncatedColorSchemas"],vectorLayers:[],customVectorLayers:[],tmsLayers:[],dataSourceRefId:""},schemas:new visDefaultEditor_public_["Schemas"]([{group:"metrics",name:"metric",title:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.mapVis.regionMapEditorConfig.schemas.metricTitle",{defaultMessage:"Value"}),min:1,max:1,aggFilter:["count","avg","sum","min","max","cardinality","top_hits","sum_bucket","min_bucket","max_bucket","avg_bucket"],defaults:[{schema:"metric",type:"count"}]},{group:"buckets",name:"segment",title:external_osdSharedDeps_OsdI18n_["i18n"].translate("regionMap.mapVis.regionMapEditorConfig.schemas.segmentTitle",{defaultMessage:"Shape field"}),min:1,max:1,aggFilter:["terms"]}])},setup:async vis=>{var _vis$data$indexPatter;const serviceSettings=await getServiceSettings();const tmsLayers=await serviceSettings.getTMSServices();vis.type.editorConfig.collections.tmsLayers=tmsLayers;if(!vis.params.wms.selectedTmsLayer&&tmsLayers.length){vis.params.wms.selectedTmsLayer=tmsLayers[0]}const vectorLayers=regionmapsConfig.layers.map(mapToLayerWithId.bind(null,public_["ORIGIN"].OPENSEARCH_DASHBOARDS_YML));const customVectorLayers=regionmapsConfig.layers.map(mapToLayerWithId.bind(null,public_["ORIGIN"].OPENSEARCH_DASHBOARDS_YML));const dataSourceRefId=((_vis$data$indexPatter=vis.data.indexPattern)===null||_vis$data$indexPatter===void 0||(_vis$data$indexPatter=_vis$data$indexPatter.dataSourceRef)===null||_vis$data$indexPatter===void 0?void 0:_vis$data$indexPatter.id)||"";vis.type.editorConfig.collections.dataSourceRefId=dataSourceRefId;const customIndices=await getCustomIndices(dataSourceRefId);let selectedLayer=vectorLayers[0];let selectedJoinField=selectedLayer?selectedLayer.fields[0]:null;let selectedCustomLayer=customVectorLayers[0];let selectedCustomJoinField=selectedCustomLayer?selectedCustomLayer.fields[0]:null;if(regionmapsConfig.includeOpenSearchMapsService){const layers=await serviceSettings.getFileLayers();const newLayers=layers.map(mapToLayerWithId.bind(null,public_["ORIGIN"].EMS)).filter(layer=>!vectorLayers.some(vectorLayer=>vectorLayer.layerId===layer.layerId));const promises=customIndices.map(idx=>addSchemaToCustomLayer(idx,dataSourceRefId));const newCustomLayers=await Promise.all(promises);newLayers.forEach(layer=>{if(layer.format==="geojson"){layer.format={type:"geojson"}}});newCustomLayers.forEach(layer=>{if(layer.format==="geojson"){layer.format={type:"geojson"};layer.isEMS=false;layer.layerId=layer.origin+"."+layer.name}});vis.type.editorConfig.collections.vectorLayers=[...vectorLayers,...newLayers];vis.type.editorConfig.collections.customVectorLayers=[...customVectorLayers,...newCustomLayers];[selectedLayer]=vis.type.editorConfig.collections.vectorLayers;selectedJoinField=selectedLayer?selectedLayer.fields[0]:null;[selectedCustomLayer]=vis.type.editorConfig.collections.customVectorLayers;selectedCustomJoinField=selectedCustomLayer?selectedCustomLayer.fields[0]:null;if(selectedLayer&&!vis.params.selectedLayer&&selectedLayer.isEMS){vis.params.emsHotLink=await serviceSettings.getEMSHotLink(selectedLayer)}}if(!vis.params.selectedLayer){vis.params.selectedLayer=selectedLayer;vis.params.selectedJoinField=selectedJoinField}if(!vis.params.selectedCustomLayer){vis.params.selectedCustomLayer=selectedCustomLayer;vis.params.selectedCustomJoinField=selectedCustomJoinField}vis.params.layerChosenByUser=vis.params.layerChosenByUser?vis.params.layerChosenByUser:common["c"];return vis}}}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}class plugin_RegionMapPlugin{constructor(initializerContext){_defineProperty(this,"_initializerContext",void 0);_defineProperty(this,"additionalOptions",void 0);this._initializerContext=initializerContext;this.additionalOptions=[]}async setup(core,_ref){let{expressions:expressions,visualizations:visualizations,mapsLegacy:mapsLegacy}=_ref;const config={...this._initializerContext.config.get(),...mapsLegacy.config.regionmap};const visualizationDependencies={http:core.http,uiSettings:core.uiSettings,regionmapsConfig:config,getServiceSettings:mapsLegacy.getServiceSettings,BaseMapsVisualization:mapsLegacy.getBaseMapsVis(),additionalOptions:this.additionalOptions};expressions.registerFunction(createRegionMapFn);visualizations.createBaseVisualization(createRegionMapTypeDefinition(visualizationDependencies));return{config:config,addOptionTab:importMapTabConfig=>this.additionalOptions.push(importMapTabConfig)}}start(core,plugins){Object(opensearch_dashboards_services["d"])(core);Object(opensearch_dashboards_services["e"])(plugins.data.fieldFormats);Object(opensearch_dashboards_services["h"])(plugins.data.query);Object(opensearch_dashboards_services["f"])(core.notifications);Object(opensearch_dashboards_services["g"])(plugins.opensearchDashboardsLegacy);Object(opensearch_dashboards_services["i"])(plugins.share);return{}}}function public_plugin(initializerContext){return new plugin_RegionMapPlugin(initializerContext)}},function(module,exports){module.exports=__osdSharedDeps__.Lodash},function(module,exports){module.exports=__osdSharedDeps__.Jquery},function(module,exports){module.exports=__osdSharedDeps__.Theme}]);